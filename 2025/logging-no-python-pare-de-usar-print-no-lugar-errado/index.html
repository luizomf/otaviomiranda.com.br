<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>
      logging no Python: Pare de usar print no lugar errado - Otávio Miranda
    </title>
    <meta
      name="description"
      content="Nesse artigo falamos do módulo logging no Python do básico ao avançado. Pare de usar o print no local errado e comece a ter logs na sua aplicação Python."
    />

    <link rel="stylesheet" href="../../css/styles_2026.css" />

    <link rel="icon" type="image/webp" href="../../imgs/favicon-1.webp" />

    <!-- conexão antecipada -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- fonte -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;800&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <input
      aria-label="Tema Claro ou Escuro (Temporário)"
      title="Tema Claro ou Escuro (Temporário)"
      id="theme-mode"
      type="checkbox"
    />

    <main class="main">
      <aside class="nav">
        <a class="copyright-link" href="/">Otávio Miranda</a>
        <a
          target="_blank"
          href="https://beacons.ai/otaviomiranda"
          rel="nofollow noopener noreferrer"
          >Contatos</a
        >
      </aside>

      <article class="article">
        <h1 id="logging-no-python-pare-de-usar-print-no-lugar-errado">
          logging no Python: Pare de usar print no lugar errado
        </h1>

        <blockquote>
          <p>Publicado em 05 de julho de 2025 | Por Luiz Otávio Miranda</p>
        </blockquote>

        <p>
          O <code>logging</code> é o módulo oficial do Python para lidar com
          logs de forma estruturada, profissional e extensível. Além disso, ele
          serve como uma alternativa muito mais poderosa ao velho e conhecido
          <code>print()</code> para debug rápido durante o desenvolvimento.
        </p>

        <p>
          Enquanto o <code>print()</code> é ótimo pra exibir algo na tela, o
          <code>logging</code> te dá controle total sobre o evento que vai ser
          registrado, <strong>como</strong> vai ser formatado e
          <strong>pra onde</strong> essa informação vai (terminal, arquivo,
          socket, banco, etc). São funções diferentes entre <code>print</code> e
          <code>logging</code>, mas esse comparativo sempre aparece quando
          falamos de <code>logging</code>.
        </p>

        <p>
          Ele também trabalha com níveis de severidade (<code>DEBUG</code>,
          <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>,
          <code>CRITICAL</code>), suporta múltiplos formatos, múltiplos destinos
          (handlers), hierarquia de loggers e configuração via código ou
          arquivos externos.
        </p>

        <p>
          Em outras palavras: ele foi feito pra <code>log</code> em aplicações
          reais. São registros de eventos categorizados para aplicações de gente
          grande, que sabe o que está fazendo e sabe que vai precisar debugar e
          refatorar o código em algum momento.
        </p>

        <p>
          O melhor é que já vem com o Python. Sem dependência. Sem gambiarra.
        </p>

        <h2 id="links-úteis-para-este-artigo">Links úteis para este artigo</h2>

        <p>
          Se você caiu nesse artigo de paraquedas, ele é apenas parte de um
          conteúdo BEM MAIOR. Temos todo esse texto em vídeo no YouTube e também
          um repositório com todo o código, segue:
        </p>

        <ul>
          <li>
            <a
              href="https://www.youtube.com/playlist?list=PLbIBj8vQhvm28qR-yvWP3JELGelWxsxaI"
              >Logging no Python - Curso completo</a
            >
          </li>
          <li>
            <a href="https://github.com/luizomf/logging_course_yt"
              >Repositório do curso</a
            >
          </li>
        </ul>

        <p>Então vamos continuar...</p>

        <h2 id="como-o-logging-funciona-por-dentro">
          Como o logging funciona por dentro
        </h2>

        <p>
          O sistema de logging do Python é organizado como uma estrutura
          hierárquica (em forma de árvore), onde cada <em>logger</em> é um
          objeto único identificado por um nome textual (por exemplo:
          <code>meuapp</code>, <code>meuapp.api</code>, etc). Essa hierarquia é
          definida simplesmente pelo nome, usando pontos (<code>.</code>) para
          indicar níveis diferentes.
        </p>

        <p>Exemplo de loggers:</p>

        <ul>
          <li><code>app</code></li>
          <li><code>app.database</code></li>
          <li><code>app.http</code></li>
          <li><code>app.http.requests</code></li>
        </ul>

        <p>Visualmente, a estrutura ficaria assim:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>root</span></span>
<span class="line"><span>└── app</span></span>
<span class="line"><span>    ├── database</span></span>
<span class="line"><span>    └── http</span></span>
<span class="line"><span>        └── requests</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Essa hierarquia permite algo muito poderoso: a
          <strong>propagação</strong> dos logs. Por padrão, quando um logger
          emite um log, essa mensagem sobe na hierarquia até chegar ao logger
          pai e, eventualmente, ao logger raiz (<code>root</code>).
        </p>

        <p>
          Na prática, isso significa que você pode configurar todos os handlers
          (por exemplo: imprimir no terminal, gravar em arquivos, enviar logs
          para serviços externos) diretamente no logger raiz.
        </p>

        <p>
          Assim, todos os loggers filhos automaticamente reutilizam esses
          handlers, sem precisar configurá-los individualmente toda vez.
        </p>

        <p>
          Só tem um detalhe importante aqui: algumas bibliotecas também usam
          loggers internamente, seguindo essa mesma hierarquia de nomes. Por
          isso, os logs emitidos por essas libs podem acabar sendo capturados
          pelos seus handlers globais também—desde que o nível configurado
          permita isso, é claro.
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> Se seu app não for grande e cheio de partes
            independentes, não precisa complicar criando múltiplos loggers e uma
            hierarquia extensa. Na maioria dos casos, um único logger já resolve
            tudo.
          </p>
        </blockquote>

        <p>
          Nos exemplos a seguir, vamos ver tudo isso funcionando claramente na
          prática.
        </p>

        <h2 id="conceitos-principais-loggers-handlers-formatters-e-filters">
          Conceitos principais: Loggers, Handlers, Formatters e Filters
        </h2>

        <p>O <code>logging</code> é formado por 4 blocos principais:</p>

        <ul>
          <li>
            <strong>Logger:</strong> é quem dispara a mensagem (ex:
            <code>logger.info("oi")</code>).
          </li>
          <li>
            <strong>Handler:</strong> define <strong>pra onde</strong> a
            mensagem vai (terminal, arquivo, e-mail etc).
          </li>
          <li>
            <strong>Formatter:</strong> define <strong>como</strong> a mensagem
            vai aparecer (formato da string).
          </li>
          <li>
            <strong>Filter (opcional):</strong> permite
            <strong>filtrar</strong> o que será logado.
          </li>
        </ul>

        <p>
          Esses blocos funcionam como peças de LEGO: você encaixa e combina como
          quiser.
        </p>

        <p>
          Pode ter um logger que salva tudo em um arquivo <code>.json</code>,
          outro que só mostra <code>ERROR</code> no terminal com cor, outro que
          manda <code>INFO</code> pro Telegram (por que não?).
        </p>

        <p>
          Tudo isso é configurável via código ou por arquivos <code>.ini</code>,
          <code>.yaml</code>, <code>.json</code>, como preferir.
        </p>

        <h2 id="níveis-de-severidade-level">Níveis de severidade: level</h2>

        <p>
          O nível de severidade (<code>level</code>) aparece em dois momentos
          distintos:
        </p>

        <ol>
          <li>Na configuração do logger e/ou handler.</li>
          <li>Na emissão do log.</li>
        </ol>

        <p>
          A primeira define o que será aceito ou descartado. A segunda define
          qual a severidade de um log específico.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># 1. Configuração: esse logger aceita logs de WARNING pra cima</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">WARNING</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># 2. Emissão: esse log será emitido com nível DEBUG</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"sou um debug"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h3 id="como-o-level-funciona">Como o level funciona?</h3>

        <p>
          Tanto loggers quanto handlers possuem um <code>level</code>. Esse
          valor determina se uma mensagem será processada ou descartada, com
          base em sua severidade.
        </p>

        <p>Os níveis disponíveis são:</p>

        <ul>
          <li>
            <code>NOTSET</code> ou <code>0</code> – sem configuração explícita.
          </li>
          <li>
            <code>DEBUG</code> ou <code>10</code> – detalhes técnicos para
            depuração (tipo <code>print()</code>).
          </li>
          <li>
            <code>INFO</code> ou <code>20</code> – informações gerais da
            execução.
          </li>
          <li>
            <code>WARNING</code> ou <code>30</code> – algo inesperado aconteceu,
            mas foi contornado.
          </li>
          <li>
            <code>ERROR</code> ou <code>40</code> – erro durante a execução.
          </li>
          <li>
            <code>CRITICAL</code> ou <code>50</code> – erro grave. A aplicação
            pode parar ou já parou.
          </li>
        </ul>

        <p>
          Você pode usar os nomes (<code>DEBUG</code>, <code>INFO</code>...) ou
          os números diretamente.
        </p>

        <blockquote>
          <p>
            O valor numérico importa porque a regra é: um log só será processado
            se o <code>level</code> desse log for maior ou igual ao
            <code>level</code> do logger e do handler.
          </p>
        </blockquote>

        <p>
          <strong>Exemplo prático usando <code>level</code></strong>
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">ERROR</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"DEBUG"</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">     # ignorado</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"WARNING"</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic"> # ignorado</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"ERROR"</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">     # processado</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"CRITICAL"</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic"> # processado</span></span>
<span class="line"></span></code></pre>

        <h3 id="emissão-de-um-log-em-um-level-específico">
          Emissão de um log em um level específico
        </h3>

        <p>
          Para emitir um log, usamos os métodos do logger que correspondem ao
          nível de severidade desejado:
        </p>

        <ul>
          <li><code>logger.debug(...)</code></li>
          <li><code>logger.info(...)</code></li>
          <li><code>logger.warning(...)</code></li>
          <li><code>logger.error(...)</code></li>
          <li><code>logger.critical(...)</code></li>
        </ul>

        <p>Exemplo:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Isso emite um log com nível WARNING (30)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem do meu log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Neste caso, estamos emitindo uma mensagem com nível 30
          (<code>WARNING</code>). Ela será avaliada pelo logger e por cada
          handler configurado, e só será processada se passar pelos filtros de
          <code>level</code>.
        </p>

        <h2 id="basicconfig-iniciando-com-logging-no-código">
          basicConfig: iniciando com logging no código
        </h2>

        <p>
          <code>basicConfig</code> é uma função do módulo <code>logging</code>,
          feita para configurar o <code>root</code> logger de forma simples e
          rápida. Geralmente, ela será usada em scripts menores para facilitar a
          configuração rápida do <code>logging</code>.
        </p>

        <p>
          Dependendo de quais argumentos forem usados, ela pode configurar
          handlers diferentes no
          <code>root logger</code>.
        </p>

        <h3 id="streamhandler-saída-para-stderr-ou-stdout">
          StreamHandler: saída para stderr ou stdout
        </h3>

        <p>
          Se você não enviar o argumento <code>filename</code> para
          <code>basicConfig</code>, o handler padrão usado será um
          <code>StreamHandler</code>.
        </p>

        <p>
          O termo <em>stream</em> se refere a objetos semelhantes a arquivos, ou
          seja, objetos que possuem métodos como <code>.write()</code> e
          <code>.flush()</code>. Tanto <code>sys.stdout</code> quanto
          <code>sys.stderr</code> são exemplos desses objetos.
        </p>

        <p>
          Por padrão, o <code>StreamHandler</code> escreve no
          <code>stderr</code>. Já o <code>print()</code> padrão do Python
          escreve no

          <code>stdout</code>. Ou seja: ambos fazem <code>print</code>, mas vão
          pra fluxos diferentes.
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> É possível trocar o stream da classe
            <code>StreamHandler</code>, passando um argumento como
            <code>sys.stdout</code>, mas isso foge do nosso foco aqui.
          </p>
        </blockquote>

        <p>
          <strong
            >Código: <code>basicConfig</code> +
            <code>StreamHandler</code></strong
          >
        </p>

        <p>
          Primeiro, importamos o módulo <code>logging</code> e definimos o
          formato de cada linha de log:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Formato do log - veja todos os atributos disponíveis em:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># https://docs.python.org/3/library/logging.html#logrecord-attributes</span></span>
<span class="line"><span style="color:#CDD6F4">simple_format </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Isso configura o root logger conforme explico a seguir.</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">format</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">simple_format</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>O trecho acima faz o seguinte:</p>

        <ul>
          <li>
            Cria um <code>StreamHandler</code> que envia os logs para o
            <code>stderr</code>;
          </li>
          <li>Aplica um <code>Formatter</code> com o formato definido;</li>
          <li>Adiciona esse handler ao <em>root logger</em>;</li>
          <li>
            Define o nível do <em>root logger</em> como
            <code>WARNING</code> (padrão do Python, caso não seja especificado).
          </li>
        </ul>

        <p>
          Com isso, o <em>root logger</em> já está pronto pra uso. Basta fazer:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Logando com o root (não vamos usar isso, só exemplo)</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Oi!"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <blockquote>
          <p>
            <strong>Nota:</strong> O <code>basicConfig</code> aceita vários
            outros argumentos, como <code>level</code>, <code>filename</code>,
            <code>filemode</code>, <code>handlers</code>, <code>stream</code> e
            mais. Se você quiser, pode definir o nível diretamente, por exemplo:
            <code>level=logging.DEBUG</code>.
          </p>
        </blockquote>

        <p>
          <strong
            ><code>getLogger()</code> cria ou acessa nosso próprio
            logger</strong
          >
        </p>

        <p>
          Com o <em>root logger</em> configurado, a gente pode usar a função
          <code>getLogger()</code> para criar (ou acessar) nossos próprios
          loggers. Essa função tem três comportamentos distintos, dependendo do
          argumento:
        </p>

        <ul>
          <li>
            <code>logging.getLogger()</code>: sem argumento, retorna o
            <em>root logger</em>.
          </li>
          <li>
            <code>logging.getLogger("meuapp")</code>: com um nome, cria um novo
            logger se ainda não existir.
          </li>
          <li>
            <code>logging.getLogger("meuapp")</code>: nas próximas chamadas com
            o mesmo nome, retorna o mesmo logger criado anteriormente (singleton
            por nome).
          </li>
        </ul>

        <p>
          Depois de criado, você pode definir o
          <strong>nível de severidade</strong> que esse logger vai aceitar:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Feito isso, já pode começar a mandar logs e ver tudo aparecendo no
          terminal:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Exibe logs com StreamHandler</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># debug info warning error critical</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Exception</span></span>
<span class="line"><span style="color:#CBA6F7">try</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#FAB387">1</span><span style="color:#94E2D5"> /</span><span style="color:#FAB387"> 0</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">except</span><span style="color:#FAB387;font-style:italic"> ZeroDivisionError</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"dividiu por zero aí"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>Saída esperada:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>DEBUG|meuapp|2025-06-29 17:36:09,226|mensagem de log|main.py|24</span></span>
<span class="line"><span>INFO|meuapp|2025-06-29 17:36:09,226|mensagem de log|main.py|25</span></span>
<span class="line"><span>WARNING|meuapp|2025-06-29 17:36:09,226|mensagem de log|main.py|26</span></span>
<span class="line"><span>ERROR|meuapp|2025-06-29 17:36:09,226|mensagem de log|main.py|27</span></span>
<span class="line"><span>CRITICAL|meuapp|2025-06-29 17:36:09,226|mensagem de log|main.py|28</span></span>
<span class="line"><span>ERROR|meuapp|2025-06-29 17:36:09,226|dividiu por zero aí|main.py|34</span></span>
<span class="line"><span>Traceback (most recent call last):</span></span>
<span class="line"><span>  File "main.py", line 32, in &lt;module&gt;</span></span>
<span class="line"><span>    print(1 / 0)</span></span>
<span class="line"><span>          ~~^~~</span></span>
<span class="line"><span>ZeroDivisionError: division by zero</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          <strong
            >Código completo para <code>basicConfig</code> e
            <code>StreamHandler</code></strong
          >
        </p>

        <p>O código completo ficou assim:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Formato para o Formatter</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Veja os atributos disponíveis em:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># https://docs.python.org/3/library/logging.html#logrecord-attributes</span></span>
<span class="line"><span style="color:#CDD6F4">simple_format </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">format</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">simple_format</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># cria o meu logger "meuapp"</span></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">try</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#FAB387">1</span><span style="color:#94E2D5"> /</span><span style="color:#FAB387"> 0</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">except</span><span style="color:#FAB387;font-style:italic"> ZeroDivisionError</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Alguém tentou dividir por zero aí."</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h3 id="filehandler-saída-para-um-arquivo">
          FileHandler: saída para um arquivo
        </h3>

        <p>
          <code>basicConfig</code> também é capaz de escrever logs em arquivos
          mudando levemente os argumentos. Precisamos passar o caminho do
          arquivo de log e o modo de abertura desejado para esse arquivo.
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> Se você mudar a pasta onde o arquivo deverá
            ser salvo, essa pasta precisa existir, do contrário terá um erro.
          </p>
        </blockquote>

        <p>Peguei só o trecho que precisa de modificação no código anterior:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">format1 </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Migrar para arquivo: basta informar o caminho, modo de abertura e encoding.</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    level</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    format</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">format1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    filename</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"log.log"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    filemode</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"a"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf-8"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Meu logger -&gt; meuapp (root -&gt; meuapp)</span></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Agora você não verá mais saída no console</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Isso deve aparecer no arquivo log.log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Arquivo log.log</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># DEBUG|meuapp|2025-07-05 10:12:30,311|Isso deve aparecer no arquivo log.log|lesson01.py|20</span></span>
<span class="line"></span></code></pre>

        <p>
          Ao fazer essa configuração, em vez de usar o
          <code>StreamHandler</code> que vimos anteriormente, agora ele usa o
          <code>FileHandler</code>. Para esse handler, precisamos do caminho do
          arquivo (<code>filename</code>), do modo de abertura
          (<code>filemode</code>) e do <code>encoding</code>.
        </p>

        <p>
          Um ponto importante aqui é que você
          <strong>não verá mais nada no terminal</strong>, porque o nosso
          handler agora envia apenas para o arquivo, e não para
          <code>stderr</code> ou <code>stdout</code>. Para ver ambos, precisamos
          de mais de um handler.
        </p>

        <p>
          O <code>filemode</code> pode ser qualquer um dos modos de escrita, por
          exemplo:
        </p>

        <ul>
          <li>
            <code>a</code> - escreve no final do arquivo (não apaga logs
            antigos, apenas adiciona)
          </li>
          <li>
            <code>w</code> - escreve no começo do arquivo (apaga tudo que estava
            lá)
          </li>
        </ul>

        <h3 id="basicconfig-filehandler-e-streamhandler">
          basicConfig, FileHandler e StreamHandler
        </h3>

        <p>
          Que tal a gente combinar tudo isso e adicionar dois handlers de uma
          vez? Bora ver como usar
          <code>FileHandler</code> e <code>StreamHandler</code> junto com a
          função <code>basicConfig</code>.
        </p>

        <p>Vou mandar o código completo pra ficar mais fácil de entender.</p>

        <p>
          No exemplo abaixo, a gente cria os dois handlers manualmente e
          adiciona eles no logger <code>root</code> via
          <code>basicConfig</code>. O resto continua o padrão de sempre.
        </p>

        <p>
          A propagação (<code>propagate = True</code>) já fica ativa por padrão.
          Isso quer dizer que, quando chamamos
        </p>

        <p>
          algo no nosso logger (que não tem handler nenhum), o log é
          <strong>propagado</strong> para o logger acima dele, no caso, o
          <code>root</code>.
        </p>

        <p>
          Como o <code>root</code> agora tem dois handlers,
          <strong>os dois são executados</strong> quando o nível de severidade
          bate. O resultado? Log no terminal <strong>e</strong> no arquivo ao
          mesmo tempo.
        </p>

        <p>
          Você poderia ter quantos handlers e formatters quisesse, todos
          pendurados no <code>root</code>.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> sys</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">format1 </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Podemos criar nossos próprios handlers usando as classes que mencionei antes</span></span>
<span class="line"><span style="color:#CDD6F4">file_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">FileHandler</span><span style="color:#9399B2">(</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    filename</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"log.log"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    mode</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"a"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">    encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf-8"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">StreamHandler</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">sys</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">stdout</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Nossos handlers precisam de um formatter</span></span>
<span class="line"><span style="color:#CDD6F4">main_formatter </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">Formatter</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">fmt</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">format1</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># A configuração do formatter pode ser reutilizada.</span></span>
<span class="line"><span style="color:#CDD6F4">file_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setFormatter</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">main_formatter</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setFormatter</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">main_formatter</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># configura o root logger</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">handlers</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">[</span><span style="color:#CDD6F4">file_handler</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> stream_handler</span><span style="color:#9399B2">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># cria o meu logger</span></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># define o nível do meu log</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Saída nos dois handlers</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Exception</span></span>
<span class="line"><span style="color:#CBA6F7">try</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#FAB387">1</span><span style="color:#94E2D5"> /</span><span style="color:#FAB387"> 0</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">except</span><span style="color:#FAB387;font-style:italic"> ZeroDivisionError</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Alguém tentou dividir por zero aí."</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          A saída do código acima fica como mostro abaixo tanto no console
          quando no terminal.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>DEBUG|meuapp|2025-07-05 10:59:37,842|mensagem de log|lesson05_01.py|41</span></span>
<span class="line"><span>INFO|meuapp|2025-07-05 10:59:37,842|mensagem de log|lesson05_01.py|42</span></span>
<span class="line"><span>WARNING|meuapp|2025-07-05 10:59:37,842|mensagem de log|lesson05_01.py|43</span></span>
<span class="line"><span>ERROR|meuapp|2025-07-05 10:59:37,842|mensagem de log|lesson05_01.py|44</span></span>
<span class="line"><span>CRITICAL|meuapp|2025-07-05 10:59:37,842|mensagem de log|lesson05_01.py|45</span></span>
<span class="line"><span>ERROR|meuapp|2025-07-05 10:59:37,843|Alguém tentou dividir por zero aí.|lesson05_01.py|51</span></span>
<span class="line"><span>Traceback (most recent call last):</span></span>
<span class="line"><span>  File "/Users/luizotavio/Desktop/tutoriais_e_cursos/logging_course_yt/src/logging_course/lesson05_01.py", line 49, in &lt;module&gt;</span></span>
<span class="line"><span>    print(1 / 0)</span></span>
<span class="line"><span>          ~~^~~</span></span>
<span class="line"><span>ZeroDivisionError: division by zero</span></span>
<span class="line"><span></span></span></code></pre>

        <h3 id="hierarquia-de-loggers-e-handlers">
          Hierarquia de Loggers e Handlers
        </h3>

        <p>
          Para unir a teoria à prática que exploramos, e para evitar as
          armadilhas mais comuns, vamos entender com precisão o que acontece no
          sistema de
          <code>logging</code> do Python:
        </p>

        <p><strong>Pontos Fundamentais para Lembrar:</strong></p>

        <ol>
          <li>
            <strong><code>basicConfig()</code></strong
            >: É a função de conveniência que configura o
            <code>root</code> logger (o "pai" de todos). Por padrão, ele
            adiciona um <code>StreamHandler</code> (para o console), um
            <code>Formatter</code> básico e define o <code>level</code> do
            <code>root</code> para <code>WARNING</code>. Em sistemas menores, é
            tranquilo usar, mas em sistemas maiores usaremos
            <code>dictConfig</code> que falaremos adiante.
          </li>
          <li>
            <strong><code>getLogger('nome')</code></strong
            >: Cria (ou obtém) um <code>Logger</code> nomeado, que é filho do de
            outro logger se o nome tiver pontos, como <code>app.modulo</code>).
            <code>root</code> logger (ou de outro logger se o nome tiver pontos,
            como <code>app.modulo</code>).
          </li>
          <li>
            <strong><code>setLevel()</code></strong
            >: Usado para definir o nível mínimo de mensagens que um
            <code>Logger</code> ou um <code>Handler</code> irá processar.
          </li>
          <li>
            <strong>Métodos de Log</strong>: <code>debug()</code>,
            <code>info()</code>, <code>warning()</code>, <code>error()</code> e
            <code>critical()</code> são os métodos que você usa em um
            <code>Logger</code> para emitir mensagens com um nível de gravidade
            específico.
          </li>
        </ol>

        <p><strong>A Grande Sacada: A Propagação e a Filtragem</strong></p>

        <p>
          Esta é a parte crucial e onde a maioria dos materiais simplifica
          demais. Preste muita atenção aqui!
        </p>

        <ol>
          <li>
            <strong>Múltiplos Handlers:</strong> Um <code>Logger</code> pode ter
            um ou vários <code>Handlers</code> anexados a ele.
          </li>
          <li>
            <strong>Handlers e Formatters:</strong> Cada <code>Handler</code> é
            responsável por direcionar o log para um destino (console, arquivo,
            etc.) e sempre usará um único <code>Formatter</code> para definir
            como a mensagem será exibida. Ele também pode ter
            <code>Filters</code> (que veremos depois) para um controle ainda
            mais fino.
          </li>
          <li>
            <strong>Níveis Duplos:</strong> Tanto o <code>Logger</code> (o
            coletor de logs) quanto o <code>Handler</code> (o publicador de
            logs) possuem seu próprio <code>level</code>. Esta é a fonte de
            possíveis problemas e pode te deixar debugando o próprio
            <code>logging</code> por horas.
          </li>
        </ol>

        <p>
          <strong
            >A Propagação: O Caminho Real do Log (e o Papel dos
            Handlers)</strong
          >
        </p>

        <p>
          Quando um log é emitido por um <code>Logger</code> nomeado, ele
          percorre uma jornada pela hierarquia. Esse "caminho" pode ser confuso,
          porque não é apenas o <code>Logger</code> que está filtrando, os
          <code>Handlers</code>
          também entram no jogo.
        </p>

        <p>Imagine a hierarquia de loggers assim:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>root           [root_handler_1, root_handler_2]</span></span>
<span class="line"><span>└── A          [A_handler_1]</span></span>
<span class="line"><span>    └── A.B    [B_handler_1, B_handler_2, B_handler_3]</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Vamos supor que o <code>level</code> de <code>A.B</code> foi
          configurado como <code>INFO</code> (20) e que emitimos:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">A</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">B</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Mensagem de Exemplo"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          <strong
            >No <code>Logger</code> <code>A.B</code> (o emissor do log)</strong
          >
        </p>

        <p>
          A primeira filtragem acontece aqui. O log tem <code>level</code>
          <code>WARNING</code> (30), e o logger <code>A.B</code> aceita logs com
          <code>INFO</code> (20) ou superior. Então a verificação é simples:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>level do log &gt;= level do logger → ok</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Se passar aqui, segue adiante. Se <strong>não</strong> passar, o log
          morre aqui, não chega em nenhum handler.
        </p>

        <p>
          <strong>Nos Handlers de <code>A.B</code></strong>
        </p>

        <p>
          Agora o log chega nos <code>Handlers</code> do logger
          <code>A.B</code>, no exemplo: <code>B<em>handler</em>1</code>,
          <code>B<em>handler</em>2</code> e <code>B<em>handler</em>3</code>.
        </p>

        <p>
          Cada handler faz <strong>sua própria checagem de level</strong>. Se o
          log for aceito, é publicado por aquele handler. Se não, é ignorado por
          ele (mas ainda pode ser aceito pelos outros handlers ou loggers
          superiores).
        </p>

        <p>
          <strong>No Logger <code>A</code> (pai de <code>A.B</code>)</strong>
        </p>

        <p>
          Se a propriedade <code>propagate</code> estiver
          <code>True</code> (valor padrão), o log
          <strong>sobe na hierarquia</strong> e chega ao logger <code>A</code>.
        </p>

        <p>
          Mas aqui vem a <strong>pegadinha</strong>: o <code>level</code> do
          logger <code>A</code> <strong>não importa mais</strong>. Ele
          <strong>não é checado</strong>.
        </p>

        <p>
          A partir daqui, só os <code>handlers</code> dos loggers pais é que
          decidem o que fazer.
        </p>

        <p>
          <strong>Nos Handlers de <code>A</code></strong>
        </p>

        <p>
          Cada handler de <code>A</code> (ex: <code>A<em>handler</em>1</code>)
          faz a mesma checagem de sempre:
        </p>

        <p>
          <code>level do log &gt;= level do handler</code>. Se passar, o log é
          publicado.
        </p>

        <p>
          <strong>No Logger <code>root</code> (e seus handlers)</strong>
        </p>
        <p>
          Mais do mesmo: o log chega no logger <code>root</code>, ignora o
          <code>level</code> dele, e é analisado apenas pelos handlers
          <code>root<em>handler</em>1</code> e
          <code>root<em>handler</em>2</code>.
        </p>

        <p>
          Essa explicação é importante porque muita gente pensa que os loggers
          pais têm o poder de
          <strong>interromper</strong> ou <strong>descartar</strong> um log que
          subiu pela propagação. Mas não têm. O único logger com poder de barrar
          a mensagem é <strong>o que emitiu o log</strong>.
        </p>

        <p>Se fosse pra resumir num post-it:</p>
        <blockquote>
          <p>
            O log é verificado <strong>no logger que o emitiu</strong>. Se
            passar, é entregue aos seus <code>handlers</code> e, com
            <code>propagate = True</code>, sobe para os loggers pais. Mas a
            partir daí, apenas os <code>handlers</code> desses loggers
            superiores<strong> fazem checagem. Os loggers pais </strong>não
            barram mais nada.
          </p>

          <p>
            Se o logger emissor não aceitar o log,
            <strong>acabou o jogo ali</strong>. Nada é publicado.
          </p>
        </blockquote>

        <h2 id="loggers-de-terceiros-podem-entrar-no-seu-log">
          Loggers de terceiros podem entrar no seu log
        </h2>

        <p>
          Se você usar o <code>logging</code> de forma incorreta: tipo deixando
          o <code>level</code> do <code>root</code> em <code>DEBUG</code> ou
          usando o <code>root</code> como logger principal por algum motivo. Uma
          coisa muito comum que costuma ocorrer é você começar a ver logs de
          <code>DEBUG</code> de aplicações de terceiros no seu log.
        </p>

        <p>
          Geralmente queremos logs de libs de terceiros no nosso log, mas não um
          milhão de <code>DEBUGs</code>. Talvez apenas de
          <code>WARNING</code> para cima, ou até de <code>ERROR</code> para
          cima.
        </p>

        <p>Vamos simular e corrigir isso a seguir.</p>

        <h3 id="rich-cobaia-e-nossos-logs-mais-bonitos-no-console">
          rich: cobaia e nossos logs mais bonitos no console
        </h3>

        <p>
          Vamos usar a biblioteca <code>rich</code> pra deixar os logs do
          console mais agradáveis de ler, com cor, syntax highlight e outros
          agrados visuais. Só que vamos usar essa lib bem mais adiante no texto.
        </p>

        <p>
          Mesmo assim, instale-a com o gerenciador que preferir e vamos usar ela
          mesmo como exemplo de log de terceiros:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Usando uv</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">uv</span><span style="color:#A6E3A1"> add</span><span style="color:#A6E3A1"> rich</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Ou com pip</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">pip</span><span style="color:#A6E3A1"> install</span><span style="color:#A6E3A1"> rich</span></span>
<span class="line"></span></code></pre>

        <h3 id="exemplo-prático-logs-de-terceiros-no-seu-log-com-rich">
          Exemplo prático: logs de terceiros no seu log com rich
        </h3>

        <p>
          Vamos configurar o <code>logging</code> novamente, do zero, só que com
          <code>root</code> configurado em <code>level</code>
          <code>DEBUG</code> (Não recomendado):
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">simple_format </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Configura o root logger com:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># - StreamHandler (stderr)</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># - Formatter customizado</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># - Level DEBUG</span></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">format</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">simple_format</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> level</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Cria o nosso logger, mas sem handlers próprios</span></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Apenas um teste</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Isso é um teste"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Saída esperada:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># WARNING|meuapp|2025-07-01 19:44:54,566|Isso é um teste|main.py|14</span></span>
<span class="line"></span></code></pre>

        <p>
          Agora, vamos simular o uso do <code>rich</code>, que é uma lib que
          também usa o módulo <code>logging</code>
          internamente. Suponha que você queira imprimir um markdown no
          terminal:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> rich </span><span style="color:#CBA6F7">import</span><span style="color:#FAB387;font-style:italic"> print</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> rprint</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> rich</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">markdown </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Markdown</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">md </span><span style="color:#94E2D5">=</span><span style="color:#89B4FA"> Markdown</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"# Nos Handlers de A"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#89B4FA">rprint</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">md</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Se algum código interno do <code>rich</code> emitir logs, mesmo que
          você não peça, esses logs vão aparecer, porque o
          <code>root</code> logger está
          <strong>aberto no nível <code>DEBUG</code></strong> e
          <strong>todos os handlers estão lá</strong>.
        </p>

        <p>Esse é o tipo de poluição que você pode querer evitar.</p>

        <p>
          Isso era só pra ser um código normal, simulando algo dentro da minha
          aplicação. Mas olha só o que apareceu no log:
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> eu cortei bastante texto do log abaixo, mas
            dependendo do que você estiver fazendo, pode ficar
            <strong>absurdamente longo</strong>. Em alguns casos, aparecem
            <strong>tantos logs</strong> que sua aplicação (ou até seu
            computador) pode travar.
          </p>
        </blockquote>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>WARNING|meuapp|2025-07-01 20:02:21,221|Isso é um teste|main.py|14</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.code|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.fence|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.blockquote|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.hr|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.list|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.reference|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.html_block|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span>DEBUG|markdown_it.rules_block.heading|2025-07-01 20:02:21,271...</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Qual o problema aqui? Nenhum, <strong>se for intencional</strong>.
        </p>

        <p>
          Só aconteceu que a sua aplicação e o <code>rich</code> decidiram
          seguir a mesma estratégia: usar o
          <code>root</code>
          logger pra tudo.
        </p>

        <p>
          Quando você configura o <code>root</code> com um nível permissivo
          (tipo <code>DEBUG</code>), qualquer lib que use o sistema de logging
          do Python pode ter suas mensagens
          <strong>publicadas nos seus handlers</strong>, inclusive aquelas que
          você nunca pediu pra logar.
        </p>

        <p>
          Como mencionei antes, é normal querermos logs de libs de terceiros no
          nosso log. Elas fazem parte da nossa aplicação, porém, em um nível
          interessante, como
          <code>WARNING</code> ou <code>ERROR</code>, e acima.
        </p>

        <h3 id="soluções-possíveis-para-log-de-libs-de-terceiros">
          Soluções possíveis para log de libs de terceiros
        </h3>

        <p>Tem várias coisas que a gente pode fazer:</p>

        <ul>
          <li>
            Subir o <code>level</code> do logger que está causando problema
          </li>
          <li>
            Configurar o <code>root</code> adequadamente (de
            <code>WARNING</code> para cima)
          </li>
          <li>
            Nunca usar o <code>root</code> logger diretamente como logger da sua
            aplicação
          </li>
          <li>
            Isolar o seu logger do <code>root</code> (não recomendado, mas pode
            ser útil se está criando uma lib para outras pessoas)
          </li>
        </ul>

        <p>
          <strong
            >Como subir o <code>level</code> de logs de terceiros com
            <code>getLogger</code>?</strong
          >
        </p>

        <p>
          No próprio log que poluiu meu console e arquivo, a
          <strong>segunda coluna</strong> mostra o nome do logger:
          <code>markdown_it</code>!
        </p>

        <p>
          Muita gente configura seus loggers como mostro a seguir. Isso é até
          uma recomendação da documentação se eu não estiver enganado:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">__name__</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Isso cria (ou acessa) um logger com o nome do módulo onde está sendo
          executado. Exemplo: se você está em um pacote chamado
          <code>learn<em>logging</em></code
          ><em>, e o módulo se chama <code>config</code></em
          ><code>logger.py</code>, o nome do logger será:
        </p>

        <ul>
          <li>
            <code><em></em>main<em></em></code> se executar direto
          </li>
          <li>
            <code>learn<em>logging.config</em>logger</code> se importar de outro
            lugar
          </li>
        </ul>

        <p>
          Mas voltando ao problema: se o log vem de <code>markdown_it</code>,
          basta fazer:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"markdown_it"</span><span style="color:#9399B2">).</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">INFO</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Geralmente isso silencia o <code>logger</code> que está jogando um
          monte de mensagens no seu logger. Mas e se forem muitos? E se forem
          todas as 10 libs externas que você está usando num código só? E se as
          10 libs que você instalou também usam outras 100 libs? Fica
          impraticável.
        </p>

        <h4 id="meus-handlers-nos-meus-loggers">
          Meus handlers nos meus loggers
        </h4>
        <p>
          Você pode configurar os
          <strong>handlers no seu próprio logger</strong>. Como estamos usando
          <code>basicConfig</code>, os handlers estavam indo pro
          <code>root</code>. Agora vamos fazer de outro modo. Só um exemplo:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Cria um handler só nosso</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">StreamHandler</span><span style="color:#9399B2">()</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Cria um formatter</span></span>
<span class="line"><span style="color:#CDD6F4">simple_format </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"><span style="color:#CDD6F4">main_formatter </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">Formatter</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">fmt</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">simple_format</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setFormatter</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">main_formatter</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># CADÊ O ROOT??? sumiu 😎</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">addHandler</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">stream_handler</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Pronto. Agora você não verá mais logs do <code>rich</code> ou de
          qualquer lib de terceiro. Não porque bloqueamos eles<strong
            >, mas porque </strong
          >não estamos mais ouvindo o <code>root</code>. E como essas libs usam
          o <code>root</code>, seus logs vão pra lugar nenhum.
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> isso pode ser um problema, visto que libs de
            terceiros fazem parte da nossa aplicação.
          </p>
          <p>
            Omitir logs de libs de terceiros é como omitir logs de uma parte do
            código que realmente vai para produção.
          </p>
          <p>
            O que eu faria nesse caso, seria manter um handler menos importante
            no meu próprio logger com level <code>DEBUG</code> (vejo tudo no meu
            handler), mas colocaria os handlers importantes, com níveis de
            <code>WARNING</code> para cima, no <code>root</code> para continuar
            tendo acesso aos logs de libs de terceiros.
          </p>
          <p>Cada caso é um caso a ser estudado.</p>
        </blockquote>

        <h2 id="dictconfig---agora-vamos-aos-negócios">
          dictConfig - agora vamos aos negócios
        </h2>

        <p>
          Como mencionei quando comecei o trecho sobre <code>basicConfig</code>,
          ela é realmente básica. E o que é mais contraditório nisso tudo, é que
          se a sua configuração for levemente mais complexa, ela se torna
          extremamente complexa também.
        </p>

        <p>
          A forma mais completa (e moderna) de configurar o
          <code>logging</code> no Python é usando <code>dictConfig</code>.
        </p>

        <p>
          Como o próprio nome indica, ao invés de ficar configurando tudo solto
          como quando usamos
        </p>

        <p>
          <code>basicConfig</code>, com <code>dictConfig</code> podemos montar
          toda a configuração usando um único dicionário.
        </p>

        <p>
          Isso te permite, inclusive, criar arquivos de configuração em outros
          formatos como JSON ou YAML, e carregar esse arquivo ao subir a
          aplicação.
        </p>

        <p>Vamos migrar essa configuração para <code>dictConfig</code>:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">file_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">FileHandler</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">filename</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"log.log"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> mode</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"a"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf-8"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">StreamHandler</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">simple_format </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">main_formatter </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">Formatter</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">fmt</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">simple_format</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">file_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setFormatter</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">main_formatter</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">stream_handler</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setFormatter</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">main_formatter</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">basicConfig</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">handlers</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">[</span><span style="color:#CDD6F4">file_handler</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> stream_handler</span><span style="color:#9399B2">])</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setLevel</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>Aqui temos o seguinte:</p>

        <ul>
          <li>
            2 handlers: <code>FileHandler</code> e <code>StreamHandler</code>
          </li>
          <li>1 formatter: <code>Formatter</code></li>
          <li>A configuração do <code>root</code> com os 2 handlers</li>
          <li>
            A configuração no nosso logger <code>meuapp</code> com
            <code>level</code> <code>DEBUG</code>
          </li>
        </ul>

        <p>Com <code>dictConfig</code> isso ficaria assim:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> dictConfig</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Dicionário de Configuração de Logging</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># A configuração centralizada para o dictConfig.</span></span>
<span class="line"><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Versão da configuração. Sempre 1 por enquanto.</span></span>
<span class="line"><span style="color:#A6E3A1">    "version"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # 'False' para não desativar loggers de bibliotecas de terceiros.</span></span>
<span class="line"><span style="color:#A6E3A1">    "disable_existing_loggers"</span><span style="color:#9399B2">:</span><span style="color:#CBA6F7"> False</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Aqui vamos configurar o(s) formatter(s)</span></span>
<span class="line"><span style="color:#A6E3A1">    "formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # A chave é o nome que você usa para se referir a esse formatter</span></span>
<span class="line"><span style="color:#A6E3A1">        "main_formatter"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # As configs são chave: valor no dicionário</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Aqui está nosso formato anterior</span></span>
<span class="line"><span style="color:#A6E3A1">            "format"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Se tiver mais formatters, basta adicionar mais chaves com nomes desejados</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Aqui vem os handlers</span></span>
<span class="line"><span style="color:#A6E3A1">    "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # É sempre a mesma ideia, a chave é o nome do handler</span></span>
<span class="line"><span style="color:#A6E3A1">        "file_handler"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.FileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "filename"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "log.log"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "mode"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "a"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "encoding"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Perceba o nome do formatter aqui (é a chave que criei lá em formatters)</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "main_formatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#A6E3A1">        "stream_handler"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "main_formatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Root</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Como o root é especial, tem uma chave só pra ele</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Configuração do logger raiz, que captura todos os logs.</span></span>
<span class="line"><span style="color:#A6E3A1">    "root"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Novamente, estou usando as chaves criadas em handlers</span></span>
<span class="line"><span style="color:#A6E3A1">        "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file_handler"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stream_handler"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Aqui vem nossos loggers, apesar de que não precisamos disso</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # vale te mostrar como funciona</span></span>
<span class="line"><span style="color:#A6E3A1">    "loggers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "meuapp"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"><span style="color:#89B4FA">dictConfig</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>Não assusta não, se você olhar direitinho só temos isso:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "version"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # sempre o mesmo valor</span></span>
<span class="line"><span style="color:#A6E3A1">    "disable_existing_loggers"</span><span style="color:#9399B2">:</span><span style="color:#CBA6F7"> False</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # para mim, sempre o mesmo valor</span></span>
<span class="line"><span style="color:#A6E3A1">    "formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {},</span><span style="color:#6C7086;font-style:italic"> # aqui vem seus formatters</span></span>
<span class="line"><span style="color:#A6E3A1">    "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {},</span><span style="color:#6C7086;font-style:italic"> # aqui os handlers</span></span>
<span class="line"><span style="color:#A6E3A1">    "filters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {},</span><span style="color:#6C7086;font-style:italic"> # aqui viriam os filters</span></span>
<span class="line"><span style="color:#A6E3A1">    "root"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {},</span><span style="color:#6C7086;font-style:italic"> # aqui as configurações do root</span></span>
<span class="line"><span style="color:#A6E3A1">    "loggers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {},</span><span style="color:#6C7086;font-style:italic"> # aqui cada chave é um logger específico</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          As duas primeiras chaves você nem precisa mexer, é sempre o mesmo
          valor. O restante são palavras que falamos algumas centenas de vezes
          ao longo desse artigo.
        </p>

        <p>
          A única coisa que pode soar estranho aqui é a estrutura, porque aqui
          você não está criando variáveis, nem está passando atributos, muito
          menos instanciando nada. Você só está informando o que você quer e o
          <code>logging</code> com a <code>dictConfig</code> que se virem. A
          nata da programação declarativa.
        </p>

        <p>
          Eu vou te passar muitas configurações diferentes ao longo do texto,
          mas se estiver com pressa, vai lá na
          <a
            href="https://docs.python.org/3/library/logging.config.html#dictionary-schema-details"
            >documentação do Python</a
          >
          para mais detalhes sobre o <code>Dictionary Schema Details</code>.
        </p>

        <h2 id="handlers-padrão-em-logginghandlers">
          Handlers padrão em logging.handlers
        </h2>

        <p>
          Caso precise de outros tipos de handlers para SMTP, SOCKET, HTTP e
          demais, antes de sair escrevendo suas classes aí, saiba todos handlers
          que temos disponíveis em <code>logging.handlers</code> (também alguns
          outros espalhados fora desse módulo).
        </p>

        <p>
          É bem provável que você não precise escrever seu handler do zero. A
          documentação desses handlers está em
          <a
            href="https://docs.python.org/3/library/logging.handlers.html#module-logging.handlers"
            >Python - logging.handlers - Logging handlers</a
          >.
        </p>

        <p><strong>Breve resumo de cada handler:</strong></p>

        <ul>
          <li>
            <strong>BaseRotatingHandler</strong> É a classe base para handlers
            que fazem rotação automática de arquivos de log. Você geralmente não
            usa diretamente, só herda dela pra criar novos handlers que
            rotacionam logs.
          </li>
          <li>
            <strong>RotatingFileHandler</strong> Grava logs num arquivo e
            automaticamente cria arquivos novos quando atingem um tamanho
            definido (por exemplo: 5 MB por arquivo).
          </li>
          <li>
            <strong>TimedRotatingFileHandler</strong> Similar ao anterior, mas
            aqui a rotação ocorre baseada em intervalos de tempo (ex: diário,
            semanal, mensal).
          </li>
          <li>
            <strong>WatchedFileHandler</strong> <em>(Unix/Linux)</em> Observa o
            arquivo de log e, se o arquivo for movido, deletado ou recriado por
            um processo externo (ex: logrotate), o handler percebe e reabre
            automaticamente.
          </li>
          <li>
            <strong>SocketHandler</strong> Envia logs via rede usando sockets
            TCP para um servidor remoto de logs.
          </li>
          <li>
            <strong>DatagramHandler</strong> Semelhante ao SocketHandler, mas
            usa UDP em vez de TCP. Isso significa que o envio dos logs é mais
            rápido, porém não confiável.
          </li>
          <li>
            <strong>SysLogHandler</strong> <em>(Linux/macOS)</em> Envia logs
            diretamente para o syslog do sistema operacional, integrando
            facilmente com o sistema operacional ou outros serviços que escutam
            o syslog.
          </li>
          <li>
            <strong>SMTPHandler</strong> Envia logs por e-mail usando SMTP.
            Comumente usado pra logs críticos (ex: erros inesperados em
            produção).
          </li>
          <li>
            <strong>NTEventLogHandler</strong> <em>(Windows)</em> Registra logs
            no Event Viewer (Visualizador de Eventos) do Windows.
          </li>
          <li>
            <strong>HTTPHandler</strong> Envia logs via requisições HTTP para um
            servidor web externo, útil em integração com APIs ou serviços de log
            em nuvem.
          </li>
          <li>
            <strong>BufferingHandler</strong> Acumula logs na memória, e só os
            libera quando o buffer atinge um limite definido. Normalmente não
            usado diretamente, serve como base para handlers que implementam
            buffering.
          </li>
          <li>
            <strong>MemoryHandler</strong> Derivado do BufferingHandler, guarda
            logs na memória até que uma condição (nível crítico ou quantidade
            máxima) seja atingida. Nesse momento, os logs são repassados para
            outro handler configurado.
          </li>
          <li>
            <strong>QueueHandler</strong> Envia logs para uma fila
            (<code>queue.Queue</code>). Ideal para processamento assíncrono de
            logs, melhorando o desempenho do app principal.
          </li>
          <li>
            <strong>QueueListener</strong> Complemento do QueueHandler, escuta
            logs em uma fila e os despacha para outros handlers configurados.
            Facilita a implementação de logging assíncrono em aplicações
            concorrentes.
          </li>
        </ul>

        <p>
          <strong
            >Handlers diretamente em logging (fora de logging.handlers):</strong
          >
        </p>

        <p>
          Além desses do módulo <code>logging.handlers</code>, tem alguns
          handlers no módulo principal (<code>logging</code>):
        </p>

        <ul>
          <li>
            <strong>StreamHandler</strong>: Escreve no terminal (<code
              >stderr</code
            >
            ou <code>stdout</code>).
          </li>
          <li>
            <strong>FileHandler</strong>: Escreve logs diretamente num arquivo
            sem rotação automática.
          </li>
          <li>
            <strong>NullHandler</strong>: Ignora completamente os logs
            recebidos, útil pra evitar avisos se nenhum handler tiver
            configurado.
          </li>
        </ul>

        <p>
          Não tenho nem como falar sobre todos esses handlers nesse artigo, mas
          creio que com o que você está aprendendo aqui, não terá dificuldade em
          implementar nenhum deles para seu caso de uso específico.
        </p>

        <h2
          id="rotatingfilehandler-e-múltiplos-streamhandler-via-stdout-e-stderr"
        >
          RotatingFileHandler e múltiplos StreamHandler via stdout e stderr
        </h2>

        <p>
          Para adicionar um pouquinho mais de complexidade (e utilidade
          prática!) na nossa configuração, vamos fazer o seguinte:
        </p>

        <ul>
          <li>
            Substituir o <code>FileHandler</code> pelo
            <code>RotatingFileHandler</code> (que rotaciona arquivos
            automaticamente);
          </li>
          <li>
            Criar um <code>StreamHandler</code> que envia logs de níveis
            <code>DEBUG</code> e <code>INFO</code> para o <code>stdout</code>;
          </li>
          <li>
            Criar outro <code>StreamHandler</code> que envia logs mais críticos
            (<code>WARNING</code>, <code>ERROR</code> e <code>CRITICAL</code>)
            para o <code>stderr</code>.
          </li>
          <li>
            Também vou criar um formatter para cada handlers. Não há necessidade
            real para isso, mas quero distinção nos três logs, então preciso de
            três formatters.
          </li>
        </ul>
        <p></p>
        <p>
          Vou quebrar o dicionário em partes porque está ficando extremamente
          grande. Vamos trabalhar com as chaves de primeiro nível do
          <code>dict</code>: <code>formatters</code>, <code>handlers</code>,
          <code>loggers</code>, <code>filters</code>, <code>root</code>, etc.
        </p>

        <p>Só o que mudar.</p>

        <h3 id="dictconfig-chave-formatters">dictConfig, chave formatters</h3>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#A6E3A1">"formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "file"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "format"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> (</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Os parenteses em strings geralmente é porque é muito longa</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Vamos usar file para os arquivos de log</span></span>
<span class="line"><span style="color:#A6E3A1">            "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"><span style="color:#9399B2">        ),</span></span>
<span class="line"><span style="color:#A6E3A1">        "datefmt"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%Y-%m-</span><span style="color:#F5C2E7">%d</span><span style="color:#A6E3A1">T%H:%M:%S%z"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Muda o formato da data</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "stdout"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Coloquei um OUT:  aqui pra gente conseguir distinguir no log</span></span>
<span class="line"><span style="color:#A6E3A1">        "format"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "OUT: [</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">] </span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "stderr"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "format"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> (</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Coloquei um ERR:  aqui pra gente conseguir distinguir no log</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Também coloquei uma cor vermelha aqui.</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Isso não tem a ver com o dict, dictConfig ou o logging</span></span>
<span class="line"><span style="color:#A6E3A1">            "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[31mERR: [</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">] </span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1"> - "</span></span>
<span class="line"><span style="color:#A6E3A1">            "</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d\033</span><span style="color:#A6E3A1">[0m"</span></span>
<span class="line"><span style="color:#9399B2">        ),</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Certo, é bem verboso, mas isso são 3 formatters, do mesmo modo que
          fizemos antes, porém em <code>dict</code>.
        </p>

        <p>
          Os nomes desses formatters são as chaves do dicionário:
          <code>file</code>, <code>stdout</code> e <code>stderr</code>.
        </p>

        <h3 id="dictconfig-chave-handlers">dictConfig, chave handlers</h3>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#A6E3A1">"handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "file"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "file"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["file"]</span></span>
<span class="line"><span style="color:#A6E3A1">        "filename"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "log.log"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Arquivo principal do log</span></span>
<span class="line"><span style="color:#A6E3A1">        "maxBytes"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1024</span><span style="color:#94E2D5"> *</span><span style="color:#FAB387"> 1024</span><span style="color:#94E2D5"> *</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Tamanho máximo do log. 5MiB</span></span>
<span class="line"><span style="color:#A6E3A1">        "backupCount"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Máximo de backups do arquivo de log</span></span>
<span class="line"><span style="color:#A6E3A1">        "encoding"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Codificação de caracteres do arquivo</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "stdout"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["stream"]</span></span>
<span class="line"><span style="color:#A6E3A1">        "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # 🚨 Isso vai gerar problema (tente entender)</span></span>
<span class="line"><span style="color:#A6E3A1">        "stream"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stdout"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # ext é algo externo ao dict: sys.stdout</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "stderr"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stderr"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["stream"]</span></span>
<span class="line"><span style="color:#A6E3A1">        "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "WARNING"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "stream"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stderr"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # ext é algo externo ao dict: sys.stderr</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">},</span></span>
<span class="line"></span></code></pre>

        <p>
          Os nomes dos handlers são as chaves do dicionário: <code>file</code>,
          <code>stdout</code> e <code>stderr</code>. Estou usando o mesmo nome
          para <code>handlers</code> e <code>formatters</code>, o que facilita a
          organização.
        </p>

        <h3 id="dictconfig-chaves-loggers-e-root">
          dictConfig, chaves loggers e root
        </h3>
        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#A6E3A1">"root"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stderr"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">},</span></span>
<span class="line"><span style="color:#A6E3A1">"loggers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "meuapp"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">},</span></span>
<span class="line"></span></code></pre>

        <p>
          Pronto, agora foi só adicionar os handlers no logger e finalizamos.
        </p>

        <h3 id="código-completo-com-dictconfig">
          Código completo com dictConfig
        </h3>

        <p>
          Isso fica extremamente verboso, mas depois vamos mover esse dicionário
          para um arquivo JSON.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> dictConfig</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "version"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "disable_existing_loggers"</span><span style="color:#9399B2">:</span><span style="color:#CBA6F7"> False</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "file"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "format"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> (</span></span>
<span class="line"><span style="color:#A6E3A1">                "</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(name)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(asctime)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d</span><span style="color:#A6E3A1">"</span></span>
<span class="line"><span style="color:#9399B2">            ),</span></span>
<span class="line"><span style="color:#A6E3A1">            "datefmt"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%Y-%m-</span><span style="color:#F5C2E7">%d</span><span style="color:#A6E3A1">T%H:%M:%S%z"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Muda o formato da data</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#A6E3A1">        "stdout"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "format"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "OUT: [</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">] </span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#A6E3A1">        "stderr"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "format"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> (</span></span>
<span class="line"><span style="color:#A6E3A1">                "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[31mERR: [</span><span style="color:#F5C2E7">%(levelname)s</span><span style="color:#A6E3A1">] </span><span style="color:#F5C2E7">%(message)s</span><span style="color:#A6E3A1"> - "</span></span>
<span class="line"><span style="color:#A6E3A1">                "</span><span style="color:#F5C2E7">%(filename)s</span><span style="color:#A6E3A1">|</span><span style="color:#F5C2E7">%(lineno)d\033</span><span style="color:#A6E3A1">[0m"</span></span>
<span class="line"><span style="color:#9399B2">            ),</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "file"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "file"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["file"]</span></span>
<span class="line"><span style="color:#A6E3A1">            "filename"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "log.log"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Arquivo principal do log</span></span>
<span class="line"><span style="color:#A6E3A1">            "maxBytes"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1024</span><span style="color:#94E2D5"> *</span><span style="color:#FAB387"> 1024</span><span style="color:#94E2D5"> *</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Tamanho máximo do log. 5MiB</span></span>
<span class="line"><span style="color:#A6E3A1">            "backupCount"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Máximo de backups do arquivo de log</span></span>
<span class="line"><span style="color:#A6E3A1">            "encoding"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Codificação de caracteres do arquivo</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#A6E3A1">        "stdout"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["stream"]</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # 🚨 Isso vai gerar problema (tente entender)</span></span>
<span class="line"><span style="color:#A6E3A1">            "stream"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stdout"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # ext é algo externo ao dict: sys.stdout</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#A6E3A1">        "stderr"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stderr"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # LOGGING_CONFIG["formatters"]["stream"]</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "WARNING"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "stream"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stderr"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # ext é algo externo ao dict: sys.stderr</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "root"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stderr"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "loggers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "meuapp"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"><span style="color:#89B4FA">dictConfig</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem de log"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Eu estava esperando uma saída diferente, mas perceba que os logs estão
          <strong>duplicados</strong>:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>OUT: [DEBUG] mensagem de log</span></span>
<span class="line"><span>OUT: [INFO] mensagem de log</span></span>
<span class="line"><span>OUT: [WARNING] mensagem de log                  ### &lt;- warning está no stdout</span></span>
<span class="line"><span>ERR: [WARNING] mensagem de log - main.py|60</span></span>
<span class="line"><span>OUT: [ERROR] mensagem de log                    ### &lt;- error está no stdout</span></span>
<span class="line"><span>ERR: [ERROR] mensagem de log - main.py|61</span></span>
<span class="line"><span>OUT: [CRITICAL] mensagem de log                 ### &lt;- critical está no stdout</span></span>
<span class="line"><span>ERR: [CRITICAL] mensagem de log - main.py|62</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Lembra que a ideia era: <code>DEBUG</code> e <code>INFO</code> vão
          para o <code>stdout</code>, e <code>WARNING</code>,
          <code>ERROR</code>, <code>CRITICAL</code> vão para o
          <code>stderr</code>?
        </p>

        <p>
          O problema está nos níveis configurados. Quando colocamos o handler
          <code>stdout</code> com nível <code>DEBUG</code>, isso significa:
        </p>

        <blockquote>
          <p>
            <strong>"Aceite logs de <code>DEBUG</code> para cima"</strong>
          </p>
        </blockquote>

        <p>
          Ou seja, ele aceita
          <strong>todos os níveis</strong> (<code>DEBUG</code>,
          <code>INFO</code>, <code>WARNING</code>, <code>ERROR</code>,
          <code>CRITICAL</code>). Por
        </p>

        <p>
          isso estamos vendo os logs mais graves saindo tanto no
          <code>stdout</code> quanto no <code>stderr</code>.
        </p>

        <p>
          Pra resolver isso, vamos precisar de <strong>filters</strong>, assim
          conseguimos controlar com mais precisão quais mensagens vão pra cada
          handler.
        </p>

        <p>
          Claro, bora terminar essa parte com estilo e clareza. Aqui vai a
          continuação ideal pra essa seção:
        </p>

        <h2 id="filters---filtrando-logs">filters - filtrando logs</h2>

        <p>
          <code>filters</code> são adicionados nos handlers ou loggers para
          controlar melhor quais mensagens de log devem ser processadas por cada
          um. Eles funcionam como um <strong>filtro extra</strong>, além do
          nível mínimo
        </p>

        <p>
          (<code>level</code>). De forma simplista, é só você imaginar que o
          <code>level</code> é um filter que veio pronto, porém é limitado.
        </p>

        <p>
          O nosso caso anterior é um exemplo clássico: Queríamos que o handler
          do <code>stdout</code> exibisse apenas <code>DEBUG</code> e
          <code>INFO</code>. Mas como ele estava com nível <code>DEBUG</code>,
          ele acabou aceitando todos os níveis acima também, e por isso vimos
          <code>WARNING</code>, <code>ERROR</code> e
          <code>CRITICAL</code> aparecendo duas vezes (uma vez no
          <code>stdout</code> e outra no <code>stderr</code>).
        </p>

        <p>
          A solução é aplicar um <code>filter</code> que
          <strong>bloqueie tudo acima de <code>INFO</code></strong> no handler
          do <code>stdout</code>.
        </p>

        <h3 id="criando-um-filter">Criando um filter</h3>

        <p>
          Vamos criar um filtro customizado simples. Estou criando outro módulo
          chamado <code>filters.py</code> no pacote em que estou
          (<code>logging_course</code>).
        </p>

        <p>
          Para criar o filter, vou criar uma classe que herda de
          <code>logging.Filter</code>. O método <code>filter</code> retorna
          <code>True</code> se aquele log é permitido ou <code>False</code> se é
          para descartar. Estranhamente, não é necessário herdar de
          <code>logging.Filter</code>, mas é mais semântico. Qualquer classe que
          tenha o método <code>filter</code> vai funcionar. Além disso, o filter
          também pode alterar o log e retornar um
          <code>LogRecord</code> completamente diferente.
        </p>

        <blockquote>
          <p>
            <strong>Nota:</strong> <code>LogRecord</code> é o objeto de log com
            todas as informações daquele log em específico. Toda vez que você
            emite um log, sua mensagem gera um novo <code>LogRecord</code> que
            vai ter a data, o módulo, o número da linha, o nível do log, etc.
          </p>
        </blockquote>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">class</span><span style="color:#F9E2AF;font-style:italic"> MaxLevelFilter</span><span style="color:#9399B2">(</span><span style="color:#F9E2AF;font-style:italic">logging</span><span style="color:#9399B2">.</span><span style="color:#F9E2AF;font-style:italic">Filter</span><span style="color:#9399B2">):</span></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#89DCEB;font-style:italic"> __init__</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> max_level</span><span style="color:#9399B2">:</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # max_level é um argumento adicional que coloquei</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # max_level deve receber o nome do level, mas quero o número</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">        super</span><span style="color:#9399B2">().</span><span style="color:#89DCEB;font-style:italic">__init__</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # self.max_level terá o número do level</span></span>
<span class="line"><span style="color:#F38BA8;font-style:italic">        self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">max_level </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLevelNamesMapping</span><span style="color:#9399B2">().</span><span style="color:#89B4FA">get</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">max_level</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">upper</span><span style="color:#9399B2">(),</span><span style="color:#FAB387"> 50</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#FAB387;font-style:italic"> filter</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> record</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> logging</span><span style="color:#9399B2">.</span><span style="color:#EBA0AC">LogRecord</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#FAB387;font-style:italic"> bool</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # record é o LogRecord que eu disse antes</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # record.levelno é o número do level do log</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # se o número do level do log for menor ou igual ao max_level que</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # definimos no filter o log passa.</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # INFO 20 só aceitará logs INFO e DEBUG.</span></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#CDD6F4"> record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">levelno </span><span style="color:#94E2D5">&lt;=</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">max_level</span></span>
<span class="line"></span></code></pre>

        <p>
          Esse filtro aceita apenas mensagens
          <strong>até o nível informado</strong>. Se passarmos
          <code>logging.INFO</code>, ele permite <code>DEBUG</code> e
          <code>INFO</code>, e bloqueia o resto.
        </p>

        <h3 id="atualizando-o-dictconfig-com-filters">
          Atualizando o dictConfig com filters
        </h3>

        <p>Agora vamos incluir o filtro na nossa configuração:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "version"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#A6E3A1">    "disable_existing_loggers"</span><span style="color:#9399B2">:</span><span style="color:#CBA6F7"> False</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # filters é uma chave de primeiro nível,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # assim como formatters</span></span>
<span class="line"><span style="color:#A6E3A1">    "filters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # O nome do meu filtro dentro da dictConfig é a chave</span></span>
<span class="line"><span style="color:#A6E3A1">        "only_debug_info"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Como é uma classe customizada, com argumento personalizado,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # temos que colocar essa chave estranha com parênteses</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # O caminho completo do meu filter: logging_course.filters.MaxLevelFilter</span></span>
<span class="line"><span style="color:#A6E3A1">            "()"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.filters.MaxLevelFilter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Meu argumento adicional com valor INFO</span></span>
<span class="line"><span style="color:#A6E3A1">            "max_level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "INFO"</span></span>
<span class="line"><span style="color:#9399B2">        }</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#A6E3A1">    "formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span><span style="color:#CDD6F4">...</span><span style="color:#9399B2">},</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # resto tudo a mesma coisa</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>E aplicar esse filtro no handler do <code>stdout</code>:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">LOGGING_CONFIG</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">    "version"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#A6E3A1">    "disable_existing_loggers"</span><span style="color:#9399B2">:</span><span style="color:#CBA6F7"> False</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#A6E3A1">    "filters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span><span style="color:#CDD6F4">...</span><span style="color:#9399B2">},</span><span style="color:#6C7086;font-style:italic"> # vimos acima</span></span>
<span class="line"><span style="color:#A6E3A1">    "formatters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span><span style="color:#CDD6F4">...</span><span style="color:#9399B2">},</span><span style="color:#6C7086;font-style:italic"> # mesma coisa</span></span>
<span class="line"><span style="color:#A6E3A1">    "handlers"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "stdout"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">            "class"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "formatter"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "level"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "filters"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"only_debug_info"</span><span style="color:#9399B2">],</span><span style="color:#6C7086;font-style:italic"> # Poderíamos ter vários filters aqui</span></span>
<span class="line"><span style="color:#A6E3A1">            "stream"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stdout"</span></span>
<span class="line"><span style="color:#9399B2">        },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # ... os outros handlers são a mesma coisa</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # ...mesma coisa</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <h3 id="resultado-final-com-filter">Resultado final com filter</h3>

        <p>Com isso, o comportamento será exatamente o que você queria:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span>OUT: [DEBUG] mensagem de log</span></span>
<span class="line"><span>OUT: [INFO] mensagem de log</span></span>
<span class="line"><span>ERR: [WARNING] mensagem de log - main.py|67</span></span>
<span class="line"><span>ERR: [ERROR] mensagem de log - main.py|68</span></span>
<span class="line"><span>ERR: [CRITICAL] mensagem de log - main.py|69</span></span>
<span class="line"><span></span></span></code></pre>

        <p>
          Agora sim, <code>stdout</code> correto, <code>stderr</code> correto.
        </p>

        <h2
          id="configuração-via-json-mas-aqui-a-gente-vai-manter-tudo-em-python"
        >
          Configuração via JSON (mas aqui a gente vai manter tudo em Python)
        </h2>
        <p>
          Apesar de ser comum externalizar a configuração do
          <code>logging</code> usando arquivos <code>.json</code>, nesse artigo
          vou manter tudo em Python para facilitar a vida, mas em um cenário
          real, é uma maravilha poder configurar tudo via "JSON".
        </p>

        <p>
          Eu estou usando JSON como exemplo, mas você pode usar qualquer formato
          que quiser. JSON, YAML,
        </p>

        <p>
          TOML são bem populares. Outra coisa importante é que o próprio
          <code>logging</code> também tem uma configuração chamada
          <code>logging.config.fileConfig</code> caso prefira, está tudo na
          <a
            href="https://docs.python.org/3/library/logging.config.html#logging.config.fileConfig"
            >documentação oficial do Python</a
          >.
        </p>

        <h3 id="exemplo-de-configuração-json-com-dictconfig">
          Exemplo de configuração JSON com dictConfig
        </h3>

        <p>
          Vamos criar um arquivo chamado <code>logging.json</code> na raiz do
          projeto. Estou criando outra configuração nesse exemplo para encurtar
          um pouco o texto (essa não é a melhor configuração, como vimos antes,
          mas vai servir). Também vou jogar o único handler que criei dentro do
          <code>root</code>.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">default</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "[%(levelname)s] %(message)s"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "default"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">stream</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stdout"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"console"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>Esse <code>DEBUG</code> aí no root chega a dar arrepios.</p>

        <p><strong>Carregando a configuração JSON com Python:</strong></p>
        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> json</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">with</span><span style="color:#FAB387;font-style:italic"> open</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"logging.json"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "r"</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> f</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    config </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">load</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">f</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">dictConfig</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">config</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p><strong>Observações:</strong></p>

        <p>
          É meio óbvio, mas JSON não é Python (wow, descobriu agora?). Mas
          sério, algumas coisas não funcionam exatamente como no Python. Um
          exemplo: eu estava usando uma cor com <code>\033[31m</code> e
          <code>\033[0m</code> (vermelho e reset). Na hora que o JSON é
          carregado, isso tudo é string normal, ou seja, vai aparecer como texto
          no seu <code>stdout</code> ou <code>stderr</code>.
        </p>

        <p>
          Tem como corrigir? Sim, já que você tocou no assunto, vamos criar
          nosso próprio formatter.
        </p>

        <h2 id="formatter-que-tal-criar-seu-próprio-formatter">
          Formatter: que tal criar seu próprio formatter?
        </h2>

        <p>
          Vamos lá, vou criar um formatter só como exemplo para você entender
          como funciona. Mas para deixar o nosso <code>console</code> mais
          bonito, vou usar o <code>rich</code> no final das contas.
        </p>

        <p>
          Assim como fiz com <code>filters</code>, vou criar outro arquivo
          chamado <code>formatters.py</code>.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> ClassVar</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">class</span><span style="color:#F9E2AF;font-style:italic"> ColorFormatter</span><span style="color:#9399B2">(</span><span style="color:#F9E2AF;font-style:italic">logging</span><span style="color:#9399B2">.</span><span style="color:#F9E2AF;font-style:italic">Formatter</span><span style="color:#9399B2">):</span></span>
<span class="line"><span style="color:#CDD6F4">    COLORS</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> ClassVar</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">]]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#A6E3A1">        "DEBUG"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[36m"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Ciano</span></span>
<span class="line"><span style="color:#A6E3A1">        "INFO"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[32m"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Verde</span></span>
<span class="line"><span style="color:#A6E3A1">        "WARNING"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[33m"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Amarelo</span></span>
<span class="line"><span style="color:#A6E3A1">        "ERROR"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[31m"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Vermelho</span></span>
<span class="line"><span style="color:#A6E3A1">        "CRITICAL"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[41m"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic">  # Fundo vermelho</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    RESET </span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1"> "</span><span style="color:#F5C2E7">\033</span><span style="color:#A6E3A1">[0m"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#FAB387;font-style:italic"> format</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> record</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> logging</span><span style="color:#9399B2">.</span><span style="color:#EBA0AC">LogRecord</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        color </span><span style="color:#94E2D5">=</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">COLORS</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">get</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">levelname</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> ""</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">        message </span><span style="color:#94E2D5">=</span><span style="color:#FAB387;font-style:italic"> super</span><span style="color:#9399B2">().</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#A6E3A1;font-style:italic"> f</span><span style="color:#A6E3A1">"</span><span style="color:#F5C2E7">{</span><span style="color:#CDD6F4">color</span><span style="color:#F5C2E7">}{</span><span style="color:#CDD6F4">message</span><span style="color:#F5C2E7">}{</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">RESET</span><span style="color:#F5C2E7">}</span><span style="color:#A6E3A1">"</span></span>
<span class="line"></span></code></pre>

        <h3 id="como-usar-no-json-com-dictconfig">
          Como usar no JSON com dictConfig
        </h3>

        <p>
          Agora vou voltar a usar a configuração que estou usando enquanto
          escrevo o artigo só pra te mostrar o tamanho que está ficando meu JSON
          e também para você ver como ficaria num cenário real.
        </p>

        <p>Esse é o meu JSON nesse momento:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">file</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%(levelname)s|%(name)s|%(asctime)s|%(message)s|%(filename)s|%(lineno)d"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">datefmt</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%Y-%m-%dT%H:%M:%S%z"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stdout</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "OUT: [%(levelname)s] %(message)s"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stderr</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ERR: [%(levelname)s] %(message)s - %(filename)s|%(lineno)d"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">color</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.formatters.ColorFormatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "[%(levelname)s] %(message)s"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">filters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">only_debug_info</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.filters.MaxLevelFilter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">max_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "INFO"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">file</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "file"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">filename</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "log.log"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">maxBytes</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5242880</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">backupCount</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">encoding</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stdout</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "color"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">filters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"only_debug_info"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">stream</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stdout"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stderr</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.StreamHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "color"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "WARNING"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">stream</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "ext://sys.stderr"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stdout"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "stderr"</span><span style="color:#9399B2">]</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">meuapp</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Se você pegou o jeito da coisa, é a mesma ideia que vimos em
          <code>filters</code> (na verdade é a mesma ideia para quase tudo).
          Sempre que eu tenho uma classe com interface diferente das classes
          padrão do <code>dictConfig</code>, preciso informar o caminho completo
          dessa classe no dicionário (ou onde quer quer estiver sua
          configuração, JSON no nosso caso). Além disso, tenho que usar
          <code>()</code> na chave, assim as chaves que vierem a seguir no JSON
          serão passadas para sua classe para configuração.
        </p>

        <p><strong>Resultado:</strong></p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">[</span><span style="color:#CDD6F4">DEBUG</span><span style="color:#9399B2">]</span><span style="color:#CDD6F4"> mensagem de log       </span><span style="color:#94E2D5">&lt;</span><span style="color:#CDD6F4">- em ciano</span></span>
<span class="line"><span style="color:#9399B2">[</span><span style="color:#CDD6F4">INFO</span><span style="color:#9399B2">]</span><span style="color:#CDD6F4"> mensagem de log        </span><span style="color:#94E2D5">&lt;</span><span style="color:#CDD6F4">- em verde</span></span>
<span class="line"><span style="color:#9399B2">[</span><span style="color:#CDD6F4">WARNING</span><span style="color:#9399B2">]</span><span style="color:#CDD6F4"> mensagem de log     </span><span style="color:#94E2D5">&lt;</span><span style="color:#CDD6F4">- em amarelo</span></span>
<span class="line"><span style="color:#9399B2">[</span><span style="color:#CDD6F4">ERROR</span><span style="color:#9399B2">]</span><span style="color:#CDD6F4"> mensagem de log       </span><span style="color:#94E2D5">&lt;</span><span style="color:#CDD6F4">- em vermelho</span></span>
<span class="line"><span style="color:#9399B2">[</span><span style="color:#CDD6F4">CRITICAL</span><span style="color:#9399B2">]</span><span style="color:#CDD6F4"> mensagem de log    </span><span style="color:#94E2D5">&lt;</span><span style="color:#CDD6F4">- fundo vermelho</span></span>
<span class="line"></span></code></pre>

        <p>
          Se quiser deixar isso ainda mais modular depois, pode mover os códigos
          ANSI pra uma constante global ou até gerar dinamicamente por tema. Mas
          isso é suficiente por agora, porque nem vamos usar isso, usaremos o
          <code>rich</code>. Como falei isso umas 30 vezes no texto, vamos ver
          como fazer isso.
        </p>

        <h2 id="richhandler---o-logging-handler-do-rich">
          RichHandler - o Logging Handler do rich
        </h2>

        <p>
          <code>rich</code> tem sido extensivamente usado com o Python para
          aplicações de terminal mais elegantes, coloridas e bonitas. E não é
          por menos: tem praticamente tudo o que você precisaria em termos de
          componentes visuais para terminal,

          <a href="https://rich.readthedocs.io/en/stable/logging.html"
            >incluindo um handler para logging</a
          >.
        </p>

        <p>
          Para usar, basta fazer o seguinte na no seu arquivo de configuração
          JSON ou no dicionário mesmo.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stdout</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">datefmt</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "[%X]"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">stdout</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "rich.logging.RichHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">omit_repeated_times</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "stdout"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"stdout"</span><span style="color:#9399B2">]</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">meuapp</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Só de fazer isso, meu log ficou como mostro na imagem a seguir. Por
          padrão o <code>RichHandler</code> emit os logs para
          <code>stdout</code>.
        </p>

        <p>
          <img
            src="images/rich_log_exemple.webp"
            alt="Exemplo de log do rich, uma tabela com os logs coloridos por nível de severidade."
          />
        </p>

        <p>
          Se quiser, pode manter o <code>rich</code> para o seu
          <code>debug</code>. E daqui em diante, toda vez que pensar em ver o
          valor de uma variável ou algo semelhante, use o log. Deixa o
          <code>print</code> para coisas que realmente precisam de print, como
          exibir algo par ao usuário mesmo.
        </p>

        <h2 id="json-log-formatter-vamos-salvar-logs-em-json-lines">
          JSON log formatter: vamos salvar logs em JSON Lines?
        </h2>

        <p>
          Só pra constar: você também pode criar seu próprio formatter e mudar o
          formato de saída para o que achar melhor. Vamos fazer isso em JSON
          porque é um dos formatos mais usados, mas você decide qual usar. A
          ideia é sempre a mesma.
        </p>

        <p>
          Na real, em vez do JSON tradicional, vamos usar uma variação chamada
          <a href="https://jsonlines.org/">JSON Lines</a> (ou NDJSON, Newline
          Delimited JSON). Nesse formato, cada linha é um objeto JSON
          independente.
        </p>

        <p>
          O motivo é simples: eficiência. Quando a gente cria um JSON comum,
          você precisa guardar tudo num único objeto (ou array). A cada novo
          log, teria que carregar esse JSON, adicionar o novo item, e depois
          salvar tudo de novo.
        </p>

        <p>
          Com JSONL, não. Podemos simplesmente dar um
          <code>append</code> (<code>a</code>) no final do arquivo, sem precisar
          mexer em nada que já estava lá.
        </p>

        <p>
          E o melhor: fazer <code>parse</code> disso é fácil. Basta ler o
          arquivo linha por linha e interpretar cada uma como um JSON separado.
        </p>

        <p>
          Até porque, convenhamos: não é todo dia que você vai fazer parse de
          logs. Mas gravar logs... isso sim, é todo dia.
        </p>

        <p>
          Também vamos melhorar o nosso <code>setup</code> de leve até chegarmos
          a uma configuração final pronta.
        </p>

        <h3 id="melhorando-nosso-setup-geral-do-logging">
          Melhorando nosso setup geral do logging
        </h3>

        <p>
          Até o momento, temos trabalhado com uma configuração toda solta. O
          ideal é movermos as partes da nossa configuração para uma função.
          Então vamos fazer o seguinte (veja nos comentários de código):
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Criei uma arquivo separado apenas para configurações</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># src/logging_course/config_logger.py</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> json</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> dictConfig</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> pathlib </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Path</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Caminhos em geral</span></span>
<span class="line"><span style="color:#CDD6F4">ROOT_DIR </span><span style="color:#94E2D5">=</span><span style="color:#89B4FA"> Path</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"."</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">  # Raiz do projeto</span></span>
<span class="line"><span style="color:#CDD6F4">LOGS_DIR </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> ROOT_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "logs"</span><span style="color:#6C7086;font-style:italic">  # Pasta para logs (./logs)</span></span>
<span class="line"><span style="color:#CDD6F4">LOG_CONFIG_PATH </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> ROOT_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "logging.json"</span><span style="color:#6C7086;font-style:italic">  # Arquivo de configuração</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">def</span><span style="color:#89B4FA;font-style:italic"> setup</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">logger_name</span><span style="color:#9399B2">:</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">Logger</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#A6E3A1">    """Configura o logger principal da aplicação."""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Se a pasta LOGS_DIR não existir, teremos um erro na aplicação,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # então verificamos e, se não existir, criamos.</span></span>
<span class="line"><span style="color:#CBA6F7">    if</span><span style="color:#CBA6F7"> not</span><span style="color:#CDD6F4"> LOGS_DIR</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">is_dir</span><span style="color:#9399B2">():</span></span>
<span class="line"><span style="color:#CDD6F4">        LOGS_DIR</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">mkdir</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">parents</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> exist_ok</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    with</span><span style="color:#CDD6F4"> LOG_CONFIG_PATH</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">open</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf8"</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        logging_config </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">load</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">file</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89B4FA">    dictConfig</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging_config</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Já estou retornando um logger, mas nem precisaria disso</span></span>
<span class="line"><span style="color:#CBA6F7">    return</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logger_name</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          A única diferença do que fizemos anteriormente é que agora você tem
          uma função encapsulando tudo.
        </p>

        <p>
          Além disso, quero jogar os arquivos de log na pasta
          <code>logs</code> para evitar ficar poluindo a raiz do meu projeto. Se
          essa pasta não existir, isso vai parar a aplicação logo quando
          <code>logging</code> for tentar salvar o arquivo de log. Se quiser
          tirar esse trecho de código da nossa função, não tem problema, basta
          criar a pasta <code>logs</code> manualmente.
        </p>

        <h3 id="formatter-personalizado-jsonloggerformatter">
          Formatter personalizado: JSONLoggerFormatter
        </h3>

        <p>
          Existem libs prontas para isso, mas como estamos aqui para aprender,
          vamos criar nosso próprio logger.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># src/logging_course/formatters.py</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> json</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> datetime </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> UTC</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> datetime</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Any</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> ClassVar</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> override</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Essas são as chaves disponíveis no LogRecord</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Podemos incluir qualquer uma dessas chaves no nosso log.</span></span>
<span class="line"><span style="color:#CDD6F4">LOG_RECORD_KEYS </span><span style="color:#94E2D5">=</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#A6E3A1">    "name"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "msg"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "args"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "levelname"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "levelno"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "pathname"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "filename"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "module"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "exc_info"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "exc_text"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "stack_info"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "lineno"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "funcName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "created"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "msecs"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "relativeCreated"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "thread"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "threadName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "processName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "process"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "taskName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Só fiz isso para separar o que é padrão do que é meu mesmo</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># message não existe em no LogRecord</span></span>
<span class="line"><span style="color:#CDD6F4">LOG_RECORDS_EXTENDED_KEYS </span><span style="color:#94E2D5">=</span><span style="color:#9399B2"> [</span><span style="color:#94E2D5">*</span><span style="color:#CDD6F4">LOG_RECORD_KEYS</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "message"</span><span style="color:#9399B2">]</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Nosso logger herda de logging.Formatter. Vou configurar tudo dessa super</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># classe por dentro do meu __init__, ou seja, não vou receber configurações</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># externas.</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># A única coisa que adicionei aqui foi include_keys, que vamos poder usar para</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># ativar ou desativar chaves do nosso log.</span></span>
<span class="line"><span style="color:#CBA6F7">class</span><span style="color:#F9E2AF;font-style:italic"> JSONLogFormatter</span><span style="color:#9399B2">(</span><span style="color:#F9E2AF;font-style:italic">logging</span><span style="color:#9399B2">.</span><span style="color:#F9E2AF;font-style:italic">Formatter</span><span style="color:#9399B2">):</span></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#89DCEB;font-style:italic"> __init__</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> include_keys</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> list</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> |</span><span style="color:#CBA6F7"> None</span><span style="color:#94E2D5"> =</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">        super</span><span style="color:#9399B2">().</span><span style="color:#89DCEB;font-style:italic">__init__</span><span style="color:#9399B2">(</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            fmt</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">None</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            datefmt</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"%Y-%m-</span><span style="color:#F5C2E7">%d</span><span style="color:#A6E3A1">T%H:%M:%S%z"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            style</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"%"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            validate</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">False</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        )</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Se você não enviar include_keys, todas as chaves serão adicionadas.</span></span>
<span class="line"><span style="color:#F38BA8;font-style:italic">        self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">include_keys </span><span style="color:#94E2D5">=</span><span style="color:#9399B2"> (</span></span>
<span class="line"><span style="color:#CDD6F4">            include_keys </span><span style="color:#CBA6F7">if</span><span style="color:#CDD6F4"> include_keys </span><span style="color:#CBA6F7">is</span><span style="color:#CBA6F7"> not</span><span style="color:#CBA6F7"> None</span><span style="color:#CBA6F7"> else</span><span style="color:#CDD6F4"> LOG_RECORDS_EXTENDED_KEYS</span></span>
<span class="line"><span style="color:#9399B2">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    @override</span></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#FAB387;font-style:italic"> format</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> record</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> logging</span><span style="color:#9399B2">.</span><span style="color:#EBA0AC">LogRecord</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Crio um dicionário onde obtenho todas as chaves de "include_keys"</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # de dentro do LogRecord (record). Inicialmente, os valores são</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # iguais, mas alguns desses valores não podem ser serializados para JSON.</span></span>
<span class="line"><span style="color:#CDD6F4">        dict_record</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#CDD6F4">            key</span><span style="color:#9399B2">:</span><span style="color:#FAB387;font-style:italic"> getattr</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> key</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">            for</span><span style="color:#CDD6F4"> key </span><span style="color:#CBA6F7">in</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">include_keys</span></span>
<span class="line"><span style="color:#CBA6F7">            if</span><span style="color:#FAB387;font-style:italic"> getattr</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> key</span><span style="color:#9399B2">,</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> is</span><span style="color:#CBA6F7"> not</span><span style="color:#CBA6F7"> None</span></span>
<span class="line"><span style="color:#CBA6F7">            and</span><span style="color:#CDD6F4"> key </span><span style="color:#CBA6F7">in</span><span style="color:#CDD6F4"> LOG_RECORDS_EXTENDED_KEYS</span></span>
<span class="line"><span style="color:#9399B2">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        if</span><span style="color:#A6E3A1"> "created"</span><span style="color:#CBA6F7"> in</span><span style="color:#CDD6F4"> dict_record</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Sobrescrevi o método formatTime para retornar um datetime</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # ao invés de struct_time que é o padrão. Assim consigo trabalhar</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # com timezone.</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            dict_record</span><span style="color:#9399B2">[</span><span style="color:#A6E3A1">"</span><span style="color:#A6E3A1;font-style:italic">created</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">formatTime</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        if</span><span style="color:#A6E3A1"> "message"</span><span style="color:#CBA6F7"> in</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">include_keys</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            dict_record</span><span style="color:#9399B2">[</span><span style="color:#A6E3A1">"</span><span style="color:#A6E3A1;font-style:italic">message</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#CDD6F4"> record</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getMessage</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        if</span><span style="color:#A6E3A1"> "exc_info"</span><span style="color:#CBA6F7"> in</span><span style="color:#CDD6F4"> dict_record </span><span style="color:#CBA6F7">and</span><span style="color:#CDD6F4"> record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">exc_info</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # exc_info traz informações sobre exceções. Precisamos formatar</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # esse valor para uma string. Por sorte isso existe em Formatter.</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            dict_record</span><span style="color:#9399B2">[</span><span style="color:#A6E3A1">"</span><span style="color:#A6E3A1;font-style:italic">exc_info</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">formatException</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">exc_info</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        if</span><span style="color:#A6E3A1"> "stack_info"</span><span style="color:#CBA6F7"> in</span><span style="color:#CDD6F4"> dict_record </span><span style="color:#CBA6F7">and</span><span style="color:#CDD6F4"> record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">stack_info</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Aqui também precisamos formatar o valor do stack da exceção para str.</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            dict_record</span><span style="color:#9399B2">[</span><span style="color:#A6E3A1">"</span><span style="color:#A6E3A1;font-style:italic">stack_info</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#F38BA8;font-style:italic"> self</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">formatStack</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">stack_info</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Caso utilize extras ao emitir o log</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Ex.: logger.warning("Mensagem", extra={"contexto": "qualquer coisa"})</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # A chave "contexto" será adicionada ao log também</span></span>
<span class="line"><span style="color:#CBA6F7">        for</span><span style="color:#CDD6F4"> key</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> val </span><span style="color:#CBA6F7">in</span><span style="color:#FAB387;font-style:italic"> vars</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">).</span><span style="color:#89B4FA">items</span><span style="color:#9399B2">():</span></span>
<span class="line"><span style="color:#CBA6F7">            if</span><span style="color:#CDD6F4"> key </span><span style="color:#CBA6F7">in</span><span style="color:#CDD6F4"> LOG_RECORDS_EXTENDED_KEYS</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">                # Essas chaves nós tratamos antes</span></span>
<span class="line"><span style="color:#CBA6F7">                continue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">            # Adicionamos a chave extra ao log</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            dict_record</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">key</span><span style="color:#9399B2">]</span><span style="color:#94E2D5"> =</span><span style="color:#CDD6F4"> val</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # E pronto, salvamos o log como JSON.</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Aqui só estamos retornando, quem salva mesmo é RotatingFileHandler.</span></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#CDD6F4"> json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">dumps</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">dict_record</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> default</span><span style="color:#94E2D5">=</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    @override</span></span>
<span class="line"><span style="color:#CBA6F7">    def</span><span style="color:#89B4FA;font-style:italic"> formatTime</span><span style="color:#9399B2">(</span><span style="color:#F38BA8;font-style:italic">self</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> record</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> logging</span><span style="color:#9399B2">.</span><span style="color:#EBA0AC">LogRecord</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> datefmt</span><span style="color:#9399B2">:</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#94E2D5"> |</span><span style="color:#CBA6F7"> None</span><span style="color:#94E2D5"> =</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # Como disse nos comentários acima, só estou trocando o timestamp</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # para datetime para ter timezone. Configure como preferir.</span></span>
<span class="line"><span style="color:#CDD6F4">        date </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> datetime</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">fromtimestamp</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">record</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">created</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> tz</span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4">UTC</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        if</span><span style="color:#CDD6F4"> datefmt</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CBA6F7">            return</span><span style="color:#CDD6F4"> date</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">strftime</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">datefmt</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#CDD6F4"> date</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">isoformat</span><span style="color:#9399B2">()</span></span>
<span class="line"></span></code></pre>

        <p>
          Não deixe de ler os comentários que deixei nos códigos. Eu estou
          deixando de escrever texto puro aqui para comentar nas linhas onde as
          coisas realmente acontece para você entender melhor.
        </p>

        <p>
          Agora só falta configurarmos o nosso <code>logging.json</code> ou o
          seu dicionário do <code>dictConfig</code>.
        </p>

        <h3 id="configuração-atual-do-nosso-loggingjson-do-dictconfig">
          Configuração atual do nosso logging.json do dictConfig
        </h3>

        <p>
          Agora vamos usar dois handlers que aprendemos antes, o
          <code>RichHandler</code> para o nosso <code>console</code> e o
          <code>RotatingFileHandler</code> para o <code>JSONLogFormatter</code>.
        </p>

        <p>Você sabe fazer isso, vamos lá:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%(message)s"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">datefmt</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%H:%M:%S"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">json</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.formatters.JSONLogFormatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">include_keys</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#A6E3A1">        "created"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "message"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "levelname"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "name"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "filename"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "module"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "exc_info"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "lineno"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "threadName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "processName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "taskName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "args"</span></span>
<span class="line"><span style="color:#9399B2">      ]</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "rich.logging.RichHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">rich_tracebacks</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">tracebacks_show_locals</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_time</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">omit_repeated_times</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">markup</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">enable_link_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">file</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "json"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">filename</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logs/log.jsonl"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">maxBytes</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5242880</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">backupCount</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">encoding</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">]</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">meuapp</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Pronto, agora temos dois logs prontos para uso em uma tacada só. Sai
          no seu terminal e vai para o arquivo <code>.jsonl</code>.
        </p>

        <h3 id="bônus-um-parser-simples-para-jsonl">
          Bônus: um parser simples para JSONL
        </h3>

        <p>
          Aqui está como fazer o parse do arquivo <code>.jsonl</code> como
          exemplo:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">def</span><span style="color:#89B4FA;font-style:italic"> parse_jsonl</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">path</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> Path</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#EBA0AC;font-style:italic"> list</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]]:</span></span>
<span class="line"><span style="color:#CBA6F7">    with</span><span style="color:#CDD6F4"> path</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">open</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"r"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf8"</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        lines </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">readlines</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    logs</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> list</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    if</span><span style="color:#CBA6F7"> not</span><span style="color:#CDD6F4"> lines</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#CDD6F4"> logs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    for</span><span style="color:#CDD6F4"> line </span><span style="color:#CBA6F7">in</span><span style="color:#CDD6F4"> lines</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        logs</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">append</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">loads</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">line</span><span style="color:#9399B2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    return</span><span style="color:#CDD6F4"> logs</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">if</span><span style="color:#CDD6F4"> __name__ </span><span style="color:#94E2D5">==</span><span style="color:#A6E3A1"> "__main__"</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CBA6F7">    from</span><span style="color:#CDD6F4"> rich </span><span style="color:#CBA6F7">import</span><span style="color:#FAB387;font-style:italic"> print</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> p</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    log_file </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> LOGS_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "log.jsonl"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    for</span><span style="color:#CDD6F4"> log </span><span style="color:#CBA6F7">in</span><span style="color:#89B4FA"> parse_jsonl</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">log_file</span><span style="color:#9399B2">):</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # This is just an example</span></span>
<span class="line"><span style="color:#89B4FA">        p</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">log</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Estamos acabando. Vamos ver só mais uma coisa que eu acho que você vai
          achar interessante.
        </p>

        <h2 id="queuehandler-e-queuelistener-log-sem-travar-sua-aplicação">
          QueueHandler e QueueListener: log sem travar sua aplicação
        </h2>

        <p>
          Às vezes, o seu logger pode virar um gargalo na aplicação. Isso mesmo.
          A função que deveria te ajudar a debugar começa a
          <strong>travar tudo</strong>. Por quê?
        </p>

        <p>Imagine isso:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Processando pedido: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> pedido</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>Parece inocente, mas se esse log for:</p>

        <ul>
          <li>
            Formatado com um <code>formatter</code> mais pesado (ex: JSON
            complexo)
          </li>
          <li>Escrito em disco (arquivo grande, I/O lento)</li>
          <li>
            Impresso no terminal com renderização colorida
            (<code>RichHandler</code>)
          </li>
          <li>Enviado para múltiplos <code>handlers</code> ao mesmo tempo</li>
          <li>Enviando por e-mail, HTTP, Socket, etc</li>
        </ul>

        <p>
          ... então essa linha pode virar <strong>um mini-freio</strong> toda
          vez que roda. E se sua app roda centenas ou milhares de logs por
          segundo (ex: scraping, filas, web, workers), esse tempo se acumula.
        </p>

        <h3 id="a-solução-enfileirar-o-log-e-deixar-outra-thread-cuidar-deles">
          A solução: enfileirar o log e deixar outra thread cuidar deles
        </h3>

        <p>
          É exatamente isso que <code>QueueHandler</code> e
          <code>QueueListener</code> fazem.
        </p>

        <blockquote>
          <p>
            Você passa a
            <strong
              >responsabilidade de processar e gravar o log para outra
              thread</strong
            >, usando uma (fila).
          </p>
        </blockquote>

        <p>Assim, sua aplicação:</p>

        <ul>
          <li>Só coloca o log na fila (<code>QueueHandler</code> faz isso)</li>
          <li>E continua rodando normal, sem esperar</li>
          <li>
            Enquanto isso, outra thread (<code>QueueListener</code>) fica
            escutando essa fila e processa os logs em segundo plano.
          </li>
        </ul>

        <h3 id="por-que-isso-funciona-tão-bem">
          Por que isso funciona tão bem?
        </h3>

        <p>
          Porque <code>queue.Queue()</code> em Python é
          <strong>thread-safe e super leve</strong>. Você consegue colocar o log
          na fila em microssegundos. A thread que escuta a fila
          (<code>QueueListener</code>) processa os logs no tempo que precisar,
          totalmente separada da thread principal da sua aplicação.
        </p>

        <h3 id="exemplo-prático-com-nosso-json-de-dictconfig">
          Exemplo prático com nosso JSON de dictConfig
        </h3>

        <p>
          Para implementar isso, vamos adicionar uma nova seção ou entrada no
          seu <code>dictConfig</code>. Ao configurar um
          <code>QueueHandler</code>, você também informará quais são os
          "handlers reais" que o <code>QueueListener</code> (que funcionará em
          uma thread separada) deve usar para processar as mensagens de log
          retiradas da fila. Basicamente:
        </p>

        <ol>
          <li>
            Definimos um <code>QueueHandler</code> que será o ponto de entrada
            dos logs na fila.
          </li>
          <li>
            Dentro da configuração desse <code>QueueHandler</code> no
            <code>dictConfig</code> (ou em uma seção
            <code>queue_listeners</code>), você indica os
            <code>handlers</code> para onde o <code>QueueListener</code> deve
            enviar os logs.
          </li>
          <li>
            Então, qualquer <code>logger</code> que você queira que se beneficie
            do processamento assíncrono, você o associa a este
            <code>QueueHandler</code>. Por exemplo, você pode mover os handlers
            que estavam no
            <code>root</code>

            logger (ou em qualquer outro logger específico) para serem
            manipulados pelo seu <code>QueueHandler</code>.
          </li>
        </ol>

        <p>No meu caso, vou usar no <code>root</code> logger.</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%(message)s"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">datefmt</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%H:%M:%S"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">json</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.formatters.JSONLogFormatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">include_keys</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#A6E3A1">        "created"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "message"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "levelname"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "name"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "filename"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "module"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "exc_info"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "lineno"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "threadName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "processName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "taskName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "args"</span></span>
<span class="line"><span style="color:#9399B2">      ]</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "rich.logging.RichHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">rich_tracebacks</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">tracebacks_show_locals</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_time</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">omit_repeated_times</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">markup</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">enable_link_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">file</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "json"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">filename</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logs/log.jsonl"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">maxBytes</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5242880</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">backupCount</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">encoding</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">queue</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.QueueHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">respect_handler_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"queue"</span><span style="color:#9399B2">]</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">meuapp</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Certo, a configuração está pronta, mas se você executou o código,
          provavelmente percebeu que os logs pararam de funcionar. Isso acontece
          porque, embora tenhamos configurado o <code>QueueHandler</code> para
          <em>colocar</em> os logs na fila,
          <strong>ninguém está lendo essa fila ainda!</strong>
        </p>

        <p>
          Lembra que o nosso objetivo é ter o <code>QueueHandler</code> para
          <strong>enfileirar</strong> os logs (tirando o peso da sua aplicação)
          e, em paralelo, o <code>QueueListener</code> para
          <strong>processar</strong> esses logs em outra thread. A configuração
          do <code>dictConfig</code> que acabamos de ver define o
          <code>QueueHandler</code> e informa para onde o
        </p>

        <p><code>QueueListener</code> deve enviar os logs.</p>

        <p>
          Agora, precisamos explicitamente iniciar o
          <code>QueueListener</code> para que ele comece a consumir as mensagens
          da fila e as encaminhe para os handlers <code>"file"</code> e
          <code>"console"</code>.
        </p>

        <p>
          Para que o sistema de log baseado em filas realmente funcione,
          precisamos dar a partida no
        </p>

        <p>
          <code>QueueListener</code>. Lembre-se, o
          <code>QueueHandler</code> apenas coloca os logs na fila; o
          <code>QueueListener</code> é quem lê e processa.
        </p>

        <p>
          Precisamos fazer isso programaticamente, após aplicar a configuração
          do <code>dictConfig</code>. Geralmente, este código é adicionado logo
          após a chamada para <code>logging.config.dictConfig()</code> (ou
          <code>fileConfig()</code>).
        </p>

        <p>
          <strong>Exemplo para iniciar o <code>QueueListener</code>:</strong>
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> atexit</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># A função getHandlerByName() está disponível a partir do Python 3.12.</span></span>
<span class="line"><span style="color:#CDD6F4">queue_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getHandlerByName</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"queue"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">if</span><span style="color:#CDD6F4"> queue_handler </span><span style="color:#CBA6F7">is</span><span style="color:#CBA6F7"> not</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # O QueueHandler, quando configurado via dictConfig com "handlers",</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # automaticamente cria e gerencia uma instância de QueueListener.</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Nós simplesmente precisamos iniciar essa instância.</span></span>
<span class="line"><span style="color:#CDD6F4">    queue_handler</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">listener</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">start</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # É crucial registrar uma função para parar o listener quando o programa</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # for encerrado. Isso garante um desligamento limpo da thread do listener.</span></span>
<span class="line"><span style="color:#CDD6F4">    atexit</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">register</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">queue_handler</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">listener</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">stop</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h2 id="meu-código-final-e-completo">Meu código final e completo</h2>

        <p>
          Fizemos muitas coisas ao longo desse artigo, mas temos que finalizar
          em algum lugar, concorda?
        </p>

        <p>
          Então vou te passar como ficou a minha configuração final com alguns
          ajustes que fiz. Sinta-se à vontade para usar e modificar como quiser.
        </p>

        <p>
          Para amarrar tudo, aqui está a versão final da sua função
          <code>setup</code> no módulo <code>config_logger</code> (na verdade,
          estou mandando o módulo inteiro, então tem mais do que só
          <code>setup</code> aí). Mudei ela levemente para incluir a lógica de
          inicialização e desligamento do <code>QueueListener</code>.
        </p>

        <p>
          Note que esta função <code>setup</code> agora é apenas para
          <strong>configurar</strong> o logger, sem criar ou retornar instâncias
          de logger. Você precisará usar
          <code>logging.getLogger('nome')</code> em outras partes da sua
          aplicação para obter e usar os loggers configurados.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> atexit</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> json</span></span>
<span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">config </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> dictConfig</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> pathlib </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Path</span></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> typing </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> Any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Caminhos em geral</span></span>
<span class="line"><span style="color:#CDD6F4">ROOT_DIR </span><span style="color:#94E2D5">=</span><span style="color:#89B4FA"> Path</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"."</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">  # Raiz do projeto</span></span>
<span class="line"><span style="color:#CDD6F4">LOGS_DIR </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> ROOT_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "logs"</span><span style="color:#6C7086;font-style:italic">  # Pasta para logs (./logs)</span></span>
<span class="line"><span style="color:#CDD6F4">LOG_CONFIG_PATH </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> ROOT_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "logging.json"</span><span style="color:#6C7086;font-style:italic">  # Arquivo de configuração</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># não preciso mais de name como argumento aqui</span></span>
<span class="line"><span style="color:#CBA6F7">def</span><span style="color:#89B4FA;font-style:italic"> setup</span><span style="color:#9399B2">()</span><span style="color:#9399B2"> -&gt;</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#A6E3A1">    """Configura o logger principal da aplicação."""</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Se a pasta LOGS_DIR não existir, teremos um erro na aplicação,</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # então verificamos e, se não existir, criamos.</span></span>
<span class="line"><span style="color:#CBA6F7">    if</span><span style="color:#CBA6F7"> not</span><span style="color:#CDD6F4"> LOGS_DIR</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">is_dir</span><span style="color:#9399B2">():</span></span>
<span class="line"><span style="color:#CDD6F4">        LOGS_DIR</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">mkdir</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">parents</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> exist_ok</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    with</span><span style="color:#CDD6F4"> LOG_CONFIG_PATH</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">open</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf8"</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        logging_config </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">load</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">file</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89B4FA">    dictConfig</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">logging_config</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # Aqui está o que adicionamos para iniciar e finalizar QueueListener</span></span>
<span class="line"><span style="color:#CDD6F4">    queue_handler </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getHandlerByName</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"queue"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">    if</span><span style="color:#CDD6F4"> queue_handler </span><span style="color:#CBA6F7">is</span><span style="color:#CBA6F7"> not</span><span style="color:#CBA6F7"> None</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # pyright não reconheceu os tipos</span></span>
<span class="line"><span style="color:#CDD6F4">        queue_handler</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">listener</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">start</span><span style="color:#9399B2">()</span><span style="color:#6C7086;font-style:italic">  # pyright: ignore</span></span>
<span class="line"><span style="color:#CDD6F4">        atexit</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">register</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">queue_handler</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">listener</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">stop</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">  # pyright: ignore</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic">    # sem retorno</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">def</span><span style="color:#89B4FA;font-style:italic"> parse_jsonl</span><span style="color:#9399B2">(</span><span style="color:#EBA0AC;font-style:italic">path</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC"> Path</span><span style="color:#9399B2">)</span><span style="color:#9399B2"> -&gt;</span><span style="color:#EBA0AC;font-style:italic"> list</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]]:</span></span>
<span class="line"><span style="color:#CBA6F7">    with</span><span style="color:#CDD6F4"> path</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">open</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"r"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> encoding</span><span style="color:#94E2D5">=</span><span style="color:#A6E3A1">"utf8"</span><span style="color:#9399B2">)</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        lines </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> file</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">readlines</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    logs</span><span style="color:#9399B2">:</span><span style="color:#EBA0AC;font-style:italic"> list</span><span style="color:#9399B2">[</span><span style="color:#EBA0AC;font-style:italic">dict</span><span style="color:#9399B2">[</span><span style="color:#FAB387;font-style:italic">str</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> Any</span><span style="color:#9399B2">]]</span><span style="color:#94E2D5"> =</span><span style="color:#9399B2"> []</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    if</span><span style="color:#CBA6F7"> not</span><span style="color:#CDD6F4"> lines</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CBA6F7">        return</span><span style="color:#CDD6F4"> logs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    for</span><span style="color:#CDD6F4"> line </span><span style="color:#CBA6F7">in</span><span style="color:#CDD6F4"> lines</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        logs</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">append</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">json</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">loads</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">line</span><span style="color:#9399B2">))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    return</span><span style="color:#CDD6F4"> logs</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">if</span><span style="color:#CDD6F4"> __name__ </span><span style="color:#94E2D5">==</span><span style="color:#A6E3A1"> "__main__"</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CBA6F7">    from</span><span style="color:#CDD6F4"> rich </span><span style="color:#CBA6F7">import</span><span style="color:#FAB387;font-style:italic"> print</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> p</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    log_file </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> LOGS_DIR </span><span style="color:#94E2D5">/</span><span style="color:#A6E3A1"> "log.jsonl"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    for</span><span style="color:#CDD6F4"> log </span><span style="color:#CBA6F7">in</span><span style="color:#89B4FA"> parse_jsonl</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">log_file</span><span style="color:#9399B2">):</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic">        # This is just an example</span></span>
<span class="line"><span style="color:#89B4FA">        p</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">log</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          O nosso JSON que funciona como configuração principal da
          <code>dictConfig</code> ficou dessa forma (não devo ter mudado nada
          nele):
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">version</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">disable_existing_loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">formatters</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">format</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%(message)s"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">datefmt</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "%H:%M:%S"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">json</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">()</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging_course.formatters.JSONLogFormatter"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">include_keys</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span></span>
<span class="line"><span style="color:#A6E3A1">        "created"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "message"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "levelname"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "name"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "filename"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "module"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "exc_info"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "lineno"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "threadName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "processName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "taskName"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">        "args"</span></span>
<span class="line"><span style="color:#9399B2">      ]</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">console</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "rich.logging.RichHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">rich_tracebacks</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">tracebacks_show_locals</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_time</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">omit_repeated_times</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> false</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">markup</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">enable_link_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">show_path</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">file</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.RotatingFileHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">formatter</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "json"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">filename</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logs/log.jsonl"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">maxBytes</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5242880</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">backupCount</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 5</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">encoding</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "utf-8"</span></span>
<span class="line"><span style="color:#9399B2">    },</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">queue</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">class</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "logging.handlers.QueueHandler"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"file"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "console"</span><span style="color:#9399B2">],</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">respect_handler_level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> true</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">root</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">handlers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> [</span><span style="color:#A6E3A1">"queue"</span><span style="color:#9399B2">]</span></span>
<span class="line"><span style="color:#9399B2">  },</span></span>
<span class="line"><span style="color:#9399B2">  "</span><span style="color:#89B4FA">loggers</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">    "</span><span style="color:#89B4FA">meuapp</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#9399B2"> {</span></span>
<span class="line"><span style="color:#9399B2">      "</span><span style="color:#89B4FA">level</span><span style="color:#9399B2">"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "DEBUG"</span></span>
<span class="line"><span style="color:#9399B2">    }</span></span>
<span class="line"><span style="color:#9399B2">  }</span></span>
<span class="line"><span style="color:#9399B2">}</span></span>
<span class="line"></span></code></pre>

        <p>
          Em qualquer parte da aplicação, eu estava testando as nossas
          configurações com o seguinte código:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">from</span><span style="color:#CDD6F4"> logging_course </span><span style="color:#CBA6F7">import</span><span style="color:#CDD6F4"> config_logger</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">if</span><span style="color:#CDD6F4"> __name__ </span><span style="color:#94E2D5">==</span><span style="color:#A6E3A1"> "__main__"</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    config_logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">setup</span><span style="color:#9399B2">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    logger </span><span style="color:#94E2D5">=</span><span style="color:#CDD6F4"> logging</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">getLogger</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"meuapp"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">})</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">})</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">})</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">})</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"mensagem"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">    try</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">        print</span><span style="color:#9399B2">(</span><span style="color:#FAB387">1</span><span style="color:#94E2D5"> /</span><span style="color:#FAB387"> 0</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CBA6F7">    except</span><span style="color:#FAB387;font-style:italic"> ZeroDivisionError</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">        logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Deu ruim"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">        logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span></span>
<span class="line"><span style="color:#A6E3A1">            "Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Luiz"</span><span style="color:#9399B2">,</span><span style="color:#A6E3A1"> "Otávio"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">}</span></span>
<span class="line"><span style="color:#9399B2">        )</span></span>
<span class="line"><span style="color:#CDD6F4">        logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Deu ruim"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> stack_info</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">        logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span></span>
<span class="line"><span style="color:#A6E3A1">            "Olá </span><span style="color:#F5C2E7">%s</span><span style="color:#F5C2E7"> %s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "Luiz"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">            "Otávio"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span><span style="color:#A6E3A1">"contexto"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "qualquer coisa"</span><span style="color:#9399B2">},</span></span>
<span class="line"><span style="color:#EBA0AC;font-style:italic">            stack_info</span><span style="color:#94E2D5">=</span><span style="color:#CBA6F7">True</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#9399B2">        )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Testando blocking"</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Esses prints são independentes do log."</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#FAB387;font-style:italic">    print</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Podem aparecer aleatóriamente no topo, meio ou final dos logs."</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h2 id="boas-práticas-no-logging-do-python-e-agora---aula-13">
          Boas Práticas no Logging do Python: e agora? - Aula 13
        </h2>

        <p>Parabéns!</p>

        <p>
          <a
            href="https://www.youtube.com/playlist?list=PLbIBj8vQhvm28qR-yvWP3JELGelWxsxaI"
            >Você chegou ao final do nosso curso</a
          >
          (e do texto, se estiver apenas lendo). A gente poderia continuar
          falando sobre logging por horas, mas agora você já deixou o
          <code>print()</code> pra trás, entendeu Handlers, Formatters, Filtros,
          <code>dictConfig</code>, JSON e até logging assíncrono com
          <code>QueueHandler</code>.
        </p>

        <p>
          Você tem um poder enorme nas mãos. Mas agora vem as perguntas mais
          importantes: Onde e como usar esse poder?<strong> </strong>O que vale
          a pena registrar?<strong> </strong>Como escrever uma mensagem de log
          que ainda faça sentido daqui a 6 meses, às 3 da manhã, quando um bug
          crítico estourar em produção?
        </p>

        <p>
          Nesta última aula, o foco muda um pouco. Vamos falar menos sobre
          <em>como configurar</em> e mais sobre
          <em>por que logar, o que logar e quando usar cada nível</em>. Vamos
          explorar as boas práticas que separam um log amador de um log
          profissional, e que podem realmente salvar sua pele quando tudo
          estiver pegando fogo.
        </p>

        <p>
          Ah, e vale lembrar: isso aqui não tem fim. Sempre tem mais pra
          aprender.
          <a
            href="https://medium.com/@joecrobak/seven-best-practices-for-keeping-sensitive-data-out-of-logs-3d7bbd12904"
            >Erros em logs acontecem até nas maiores empresas do mundo</a
          >, então continue estudando, melhorando, revisando seus logs... e
          evitando que eles virem uma armadilha.
        </p>

        <h3 id="para-quem-você-está-escrevendo-o-log">
          Para Quem Você Está Escrevendo o Log?
        </h3>

        <p>
          Antes de mais nada:
          <strong>log não é só pra você, desenvolvedor.</strong> Na verdade, o
          que deve ser registrado em log geralmente
          <strong>não é decidido apenas pelos devs</strong>. Em ambientes
          profissionais, outros setores também dependem desses dados.
        </p>

        <p>
          Claro, como dev, você provavelmente vai usar <code>debug</code>,
          <code>info</code>, <code>warning</code>,<code>error</code>,
          <code>critical</code> e <code>exception</code> para entender o
          comportamento do seu código. Mas a empresa como um todo precisa de
          muito mais:
        </p>

        <ul>
          <li>O usuário criou uma conta</li>
          <li>O usuário fez login</li>
          <li>Visualizou o produto X</li>
          <li>Comprou o produto Y</li>
          <li>Pesquisou por "banana orgânica"</li>
        </ul>

        <p>
          Tudo isso pode parecer irrelevante para debugging técnico, mas para
          outras áreas, esses logs são
          <strong>ouro em forma de texto</strong>. Gente de marketing, produto,
          segurança, auditoria... todos querem (e precisam) ver esses eventos.
        </p>

        <p>
          Então,
          <strong>antes de sair logando tudo no <code>debug</code></strong
          >, entenda o <strong>propósito</strong> do log. Você está logando para
          debug ou para outro setor? Se é para outro setor, quais dados eles
          precisam? Esses dados podem ser salvos? São sensíveis?
        </p>

        <p>Veja alguns exemplos genéricos:</p>

        <ul>
          <li>
            <strong>Logs para Desenvolvedores (Você do Futuro):</strong> Foco em
            debugging. Informações que ajudam a entender o fluxo da aplicação, o
            estado de variáveis e a causa de um bug (não é só debug, todos os
            níveis de log podem ser relevantes aqui).
          </li>
          <li>
            <strong>Logs para SysAdmins / SRE / DevOps (Monitoramento):</strong>
            Foco em saúde do sistema. Logs sobre falhas, lentidão, uso de
            recursos, quedas de serviço, etc.
          </li>
          <li>
            <strong>Logs para o Negócio / Auditoria (Análise):</strong> Foco em
            rastrear ações importantes do ponto de vista do negócio. Exemplo:
            "Usuário X comprou produto Y", "Relatório Z foi gerado" (claro, você
            precisa se comunicar com outros setores para saber o que logar).
          </li>
          <li>
            <strong>Logs para fins legais?</strong> Se um usuário da sua
            aplicação fizer algo ilegal, talvez a justiça queira saber o que
            aconteceu. Aqui entra outro tipo de responsabilidade: retenção de
            logs, dados sensíveis, LGPD, etc.
            <strong>Consulte um advogado</strong> (ou o jurídico da empresa)
            para saber o que pode ou não ser armazenado.
          </li>
        </ul>

        <h3 id="decifrando-os-níveis-de-severidade-na-prática">
          Decifrando os Níveis de Severidade na Prática
        </h3>

        <p>
          Agora sim:
          <strong
            >vamos entender quando usar cada nível de log na prática.</strong
          >
          Abaixo você encontra a descrição de cada nível com exemplos concretos,
          tanto de situações quanto de código.
        </p>

        <h4 id="debug-esse-é-nosso-dos-devs">
          DEBUG: "Esse é nosso (dos devs)"
        </h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Para diagnóstico detalhado durante o
            desenvolvimento ou debugging intenso.
          </li>
          <li>
            <strong>O que logar:</strong> Variáveis internas, payloads de API,
            queries SQL, entrada e saída de funções complexas.
          </li>
          <li>
            <strong>Regra:</strong> Geralmente desativado em produção para
            evitar excesso de ruído (e vazamento de dados sensíveis da
            aplicação).
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Cuidado com isso, payload pode conter dados sensíveis da aplicação</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># e do usuário</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Iniciando função de login com payload: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> payload</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># Cuidado novamente (nem preciso falar de novo né?)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Consulta SQL gerada: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> query</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h4 id="info-aconteceu-algo-certo">INFO: Aconteceu algo certo</h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Para registrar eventos normais e
            esperados no fluxo da aplicação.
          </li>
          <li>
            <strong>O que logar:</strong> Login de usuário, criação de conta,
            execução bem-sucedida de uma tarefa.
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># Sem senhas, pelo amor de Deus</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Usuário </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1"> logou com sucesso"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> username</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Relatório gerado e enviado por email"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h4 id="warning-atenção-algo-inesperado-aconteceu">
          WARNING: Atenção, algo inesperado aconteceu
        </h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Quando algo não saiu como o esperado,
            mas a aplicação conseguiu se recuperar.
          </li>
          <li>
            <strong>O que logar:</strong> Funcionalidades obsoletas, API lenta,
            falha com fallback, tentativa de reconexão, muitas tentativas de
            login, etc...
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"API externa demorou </span><span style="color:#F5C2E7">%d</span><span style="color:#A6E3A1"> segundos para responder"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> elapsed</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">warning</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Configuração 'X' está obsoleta. Use 'Y' no lugar."</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h4 id="error-uma-operação-falhou">ERROR: Uma operação falhou</h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Quando uma tarefa específica não pôde
            ser concluída, mas a aplicação continua rodando.
          </li>
          <li>
            <strong>O que logar:</strong> Falha de validação, erro ao salvar no
            banco, exceção tratada que impediu o sucesso da operação, etc.
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Erro ao salvar usuário no banco: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> user_id</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Falha ao processar pagamento: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#FAB387;font-style:italic"> str</span><span style="color:#9399B2">(</span><span style="color:#CDD6F4">error</span><span style="color:#9399B2">))</span></span>
<span class="line"></span></code></pre>

        <h4 id="critical-o-navio-está-afundando">
          CRITICAL: O navio está afundando!
        </h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Para falhas graves que impedem o
            funcionamento da aplicação.
          </li>
          <li>
            <strong>O que logar:</strong> Perda de conexão com o banco após
            várias tentativas, falha na inicialização de componente essencial,
            falha na rede interna, etc.
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Banco de dados inacessível após 5 tentativas. Encerrando aplicação."</span><span style="color:#9399B2">)</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">critical</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Arquivo de configuração principal está corrompido."</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <h4 id="menção-honrosa-loggerexception">
          Menção honrosa: logger.exception()
        </h4>

        <ul>
          <li>
            <strong>Quando usar:</strong> Sempre que você estiver dentro de um
            bloco <code>try...except</code> é interessante logar a exceção na
            maioria dos casos.
          </li>
          <li>
            <strong>Vantagem:</strong> Além de logar como <code>error</code>,
            ele inclui automaticamente o <strong>traceback</strong>. Isso é ouro
            puro para debugging.
          </li>
        </ul>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">try</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    resultado </span><span style="color:#94E2D5">=</span><span style="color:#89B4FA"> processar_pagamento</span><span style="color:#9399B2">()</span></span>
<span class="line"><span style="color:#CBA6F7">except</span><span style="color:#FAB387;font-style:italic"> Exception</span><span style="color:#CBA6F7"> as</span><span style="color:#CDD6F4"> e</span><span style="color:#9399B2">:</span></span>
<span class="line"><span style="color:#CDD6F4">    logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">exception</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Erro inesperado ao processar pagamento"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span></code></pre>

        <p>
          Com esses exemplos em mente, você já consegue diferenciar claramente o
          papel de cada nível de severidade e aplicar isso com consciência. O
          importante é manter consistência, clareza e foco em quem vai ler o log
          depois, muitas vezes, esse alguém vai ser você mesmo (só que com sono
          e pressa).
        </p>

        <p>
          Além disso, como o que aprendemos sobre <code>loggers</code>,
          <code>handlers</code> e <code>filters</code>, você conseguirá separar
          bem os logs por pacote, módulo, por setor da empresa, ou como
          preferir. Também conseguirá filtrar dados desnecessários em logs
          específicos.
        </p>

        <h3 id="as-regras-de-ouro-de-uma-boa-mensagem-de-log">
          As Regras de Ouro de uma Boa Mensagem de Log
        </h3>

        <p>
          Depois de tudo que aprendemos sobre configuração e níveis de log,
          chegou a hora da pergunta mais importante:
        </p>

        <p>
          <strong
            >Como escrever uma mensagem de log que realmente ajuda?</strong
          >
        </p>

        <p>
          Aqui vão 3 regras de ouro, simples, mas poderosas, que separam logs
          descartáveis de logs profissionais e confiáveis.
        </p>

        <h4 id="regra-1-escreva-logs-para-máquinas-também-não-só-para-humanos">
          Regra 1: Escreva logs para máquinas também, não só para humanos
        </h4>

        <p>
          Sim, logs precisam ser legíveis. Mas eles também devem ser
          <strong>estruturados e processáveis</strong> por ferramentas de
          observabilidade, buscas e alertas.
        </p>

        <p>Evite logs "misteriosos" e difíceis de analisar com código.</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic">#🚫 Ruim:</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Erro no usuário 123"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># ✅ Bom:</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Falha na atualização do perfil"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#A6E3A1">    "user_id"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 123</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "reason"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "email_invalido"</span></span>
<span class="line"><span style="color:#9399B2">})</span></span>
<span class="line"></span></code></pre>

        <p>
          Com logs estruturados (em JSON, como fizemos), você pode filtrar todos
          os erros por
          <code>reason=email<em>invalido</em></code
          ><em>, ou agrupar por <code>user</code></em
          ><code>id</code>. Isso é impossível com strings soltas e mal
          formatadas.
        </p>

        <h4 id="regra-2-contexto-é-rei">Regra 2: Contexto é rei</h4>

        <p>
          A mensagem "<code>Falhou</code>" pode ser verdade, mas não ajuda em
          nada. Um bom log responde:
          <strong>Quem? O quê? Onde? Quando? Por quê?</strong>
        </p>

        <p>
          Inclua IDs relevantes (de usuário, pedido, transação, etc). Quanto
          mais contexto você der, mais rápido será o diagnóstico, inclusive por
          outras pessoas do time (ou você no futuro, com pressa e sem
          paciência). Evite também colocar coisas desnecessárias no log (falo
          disso adiante).
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># 🚫 Ruim:</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Pagamento não foi processado"</span><span style="color:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># ✅ Bom:</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">error</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Erro ao processar pagamento"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#A6E3A1">    "user_id"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 42</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "order_id"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 101</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "gateway"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Stripe"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "error_code"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "card_declined"</span></span>
<span class="line"><span style="color:#9399B2">})</span></span>
<span class="line"></span></code></pre>

        <h4 id="regra-3-nunca-logue-informações-sensíveis">
          Regra 3: NUNCA logue informações sensíveis
        </h4>

        <p>
          Isso é mais do que uma boa prática: é uma questão legal e de
          segurança.
        </p>
        <p>O que <strong>nunca</strong> deve aparecer em logs:</p>

        <ul>
          <li>Senhas (óbvio, né?)</li>
          <li>Tokens de autenticação ou sessão</li>
          <li>Chaves de API</li>
          <li>Números de cartão de crédito</li>
          <li>Documentos como CPF, RG, etc.</li>
          <li>
            Endereços físicos de clientes, colaboradores, fornecedores, etc.
          </li>
          <li>Dados médicos ou sensíveis (LGPD/GDPR)</li>
        </ul>

        <p>
          <em>Dica técnica:</em> Se você precisa logar objetos que podem conter
          dados sensíveis (ex: um <code>User</code> ou um <code>Request</code>),
          crie uma função de serialização segura, ou use um
          <strong>Filter</strong> para limpar ou mascarar os dados antes de
          enviar ao log.
        </p>

        <h4 id="regra-4-contexto-é-bom-até-virar-poluição">
          Regra 4: Contexto é bom… até virar poluição
        </h4>

        <p>
          Sim, na <strong>Regra 2</strong> eu disse que <em>contexto é rei</em>.
          Mas cuidado pra não transformar o seu log num
          <strong>romance de 800 páginas com final inconclusivo</strong>. Logar
          dados demais é tão ruim quanto logar de menos.
        </p>

        <ul>
          <li>Vai deixar os arquivos gigantes</li>
          <li>Vai dificultar buscas e análise</li>
          <li>Pode até esconder o que realmente importa</li>
          <li>Vai ficar caro</li>
          <li>Tem mais coisa ruim que não lembrei...</li>
        </ul>

        <p><strong>Ruído esconde o sinal.</strong></p>

        <p>Veja um exemplo de poluição:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># 🚫 Ruim:</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">debug</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Resposta completa da API: </span><span style="color:#F5C2E7">%s</span><span style="color:#A6E3A1">"</span><span style="color:#9399B2">,</span><span style="color:#CDD6F4"> response</span><span style="color:#9399B2">.</span><span style="color:#CDD6F4">text</span><span style="color:#9399B2">)</span><span style="color:#6C7086;font-style:italic">  # 1000 linhas de HTML</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Usuário fez login"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#A6E3A1">    "user_id"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "nome"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Fulano"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "email"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "fulano@email.com"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # dado sensível</span></span>
<span class="line"><span style="color:#A6E3A1">    "cpf"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "123.456.789-00"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # dado sensível</span></span>
<span class="line"><span style="color:#A6E3A1">    "endereco"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Rua tal, nº tal, bairro tal"</span><span style="color:#9399B2">,</span><span style="color:#6C7086;font-style:italic"> # dado sensível</span></span>
<span class="line"><span style="color:#A6E3A1">    "navegador"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "Chrome 126"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "sistema"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "macOS"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "resolução"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "1920x1080"</span><span style="color:#9399B2">,</span></span>
<span class="line"><span style="color:#A6E3A1">    "timestamp"</span><span style="color:#9399B2">:</span><span style="color:#A6E3A1"> "2025-07-10T15:34:21Z"</span></span>
<span class="line"><span style="color:#9399B2">})</span></span>
<span class="line"></span></code></pre>

        <p>Melhor seria algo como:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#6C7086;font-style:italic"># ✅ melhor - é o mesmo log, mas eu consigo usar o ID do usuário para fazer</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic"># buscas internas no sistema.</span></span>
<span class="line"><span style="color:#CDD6F4">logger</span><span style="color:#9399B2">.</span><span style="color:#89B4FA">info</span><span style="color:#9399B2">(</span><span style="color:#A6E3A1">"Login realizado com sucesso"</span><span style="color:#9399B2">,</span><span style="color:#EBA0AC;font-style:italic"> extra</span><span style="color:#94E2D5">=</span><span style="color:#9399B2">{</span></span>
<span class="line"><span style="color:#A6E3A1">    "user_id"</span><span style="color:#9399B2">:</span><span style="color:#FAB387"> 1</span><span style="color:#6C7086;font-style:italic"> # Com o ID do usuário você consegue buscar outros dados</span></span>
<span class="line"><span style="color:#9399B2">})</span></span>
<span class="line"></span></code></pre>

        <p>
          <strong>Regra prática:</strong> Logue <em>apenas</em> o que alguém
          precisa saber para <strong>agir</strong>. Se o dado não ajuda a
          entender, resolver ou monitorar o problema, talvez ele não precise
          estar ali. Geralmente, IDs que identificam algo são suficientes para
          fazer uma busca interna no sistema sem expor dados sensíveis em logs.
        </p>

        <p>
          Lembre-se que quando você não precisa de logs, eles são "lixo" e até
          inconvenientes. Em algum momento alguém pode esquecer algo e vazar
          logs da sua aplicação. Se isso acontecer, torça muito para não ter
          nenhum dado sensível no meio dos dados vazados.
        </p>

        <h3 id="concluindo">Concluindo</h3>

        <p>Se você chegou até aqui, parabéns. De verdade.</p>

        <p>
          Você saiu do <code>print()</code> e agora tem um
          <strong>arsenal completo de logging profissional</strong> nas mãos:
          Handlers, Formatters, Filters, JSON, <code>dictConfig</code>, logs
          assíncronos com <code>QueueHandler</code>, e, mais importante,
          <strong>boas práticas de uso</strong>.
        </p>

        <p>
          Você entendeu que logging não é só sobre escrever mensagens no
          console. É sobre
          <strong>observabilidade</strong>, <strong>diagnóstico rápido</strong>,
          <strong>comunicação entre times</strong>, <strong>segurança</strong> e
          até <strong>compliance legal</strong>. Ou seja: logging bem feito
          salva seu código, sua sanidade e, às vezes, até o faturamento da
          empresa.
        </p>

        <p><strong>E agora, o que fazer com esse conhecimento?</strong></p>

        <p>
          Use. Refatore seus projetos. Melhore os logs do seu time. Mostre esse
          curso pra alguém que ainda vive no <code>print()</code>.
        </p>

        <p>
          E quando for criar algo novo… lembra disso: um bom log não é ruído. É
          música pros ouvidos de quem tá tentando resolver um bug às 3 da manhã.
        </p>

        <p>
          Valeu demais por acompanhar até aqui! Se você curtiu, compartilha, vai
          lá no vídeo e comenta, salva, manda pra galera. E se quiser aprender
          mais Python moderno, CLI, automações, ou IA aplicada ao mundo real, dá
          uma olhada nas outras playlists do canal ou nos cursos completos.
        </p>

        <p>Nos vemos nos próximos vídeos ou textos.</p>

        <p>Abraço!</p>

        <hr />

        <p>
          Se quiser, esse texto está em markdown e
          <a href="text.md">pode ser baixado aqui</a>. Você também rolou
          bastante essa página né? <a href="./">Volte para o topo</a> ou
          simplesmente vá para <a href="/">nossa página inicial</a>.
        </p>
      </article>

      <footer class="nav">
        <a class="copyright-link" href="/">Otávio Miranda</a>
        <a
          target="_blank"
          href="https://beacons.ai/otaviomiranda"
          rel="nofollow noopener noreferrer"
          >Contatos</a
        >
      </footer>
    </main>

    <script defer src="../../js/scripts_2026.js"></script>
  </body>
</html>
