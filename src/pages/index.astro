---
import BaseLayout from '../layouts/BaseLayout.astro';
import Hero from '../components/Hero.astro';
import Courses from '../components/Courses.astro';
import Testimonials from '../components/Testimonials.astro';
import Footer from '../components/Footer.astro';
import Newsletter from '../components/Newsletter.astro';
import Section from '../components/Section.astro';
import SectionHeader from '../components/SectionHeader.astro';
import RecentPostLink from '../components/RecentPostLink.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import { comparePostsByDateDesc } from '../utils/post-date';
import { getEntryHref } from '../utils/post-path';

const posts = await getCollection('posts');
posts.sort(comparePostsByDateDesc);
const recentPosts: CollectionEntry<'posts'>[] = posts.slice(0, 5);
---

<BaseLayout>
  <!-- 1. Hero Section -->
  <Hero />

  <!-- 2. Courses Section -->
  <Courses />

  <!-- 3. Coupon Section -->
  <Section
    id='section-coupon'
    theme='dark'
    class='bg-parallax'
    contentClass='section-coupon'
  >
    <SectionHeader
      eyeball='Para você'
      title='Desconto exclusivo'
      description='Leve sua carreira de desenvolvedor para o próximo nível pagando menos. Use o cupom abaixo e tenha acesso vitalício.'
    >
      <div class='discount-container'>
        <div class='coupon glass'>JAN282026</div>
        <div class='coupon-date'>Válido até 02/02/2026</div>
      </div>
    </SectionHeader>
  </Section>

  <!-- 4. Blog Posts Static Placeholder (Will become dynamic later) -->
  <Section id='section-blog' theme='light' contentClass='section-blog'>
    <SectionHeader
      class='blog-header'
      eyeball='Últimos posts do'
      title='Meu blog'
      description='Minhas notas de estudo acabaram se tornando tutoriais sobre o ecossistema de engenharia de software.'
    />

    <ul class='blog-list'>
      {
        recentPosts.map(post => (
          <RecentPostLink href={getEntryHref(post)} title={post.data.title} />
        ))
      }
    </ul>

    <div style='text-align: center; margin-top: 2rem;'>
      <a
        href='/blog/1/'
        class='button'
        style='display: inline-block; padding: 1rem 2rem; background-color: var(--main-clr); color: var(--main-clr-shade); text-decoration: none; font-weight: 800; border-radius: 4px; border: 2px solid var(--secondary-clr); transition: all 0.2s ease;'
      >
        Ver todos os posts
      </a>
    </div>
  </Section>
  <!-- 5. Testimonials Section -->
  <Testimonials />

  <!-- 6. Newsletter -->
  <Newsletter />

  <!-- 7. Footer -->
  <Footer />
</BaseLayout>
