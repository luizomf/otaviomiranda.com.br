---
// src/pages/[...slug].astro
import { getCollection, render, type CollectionEntry } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Newsletter from '../components/Newsletter.astro';
import { getEntrySlugPath } from '../utils/post-path';

export async function getStaticPaths() {
  const blogEntries = await getCollection('posts');
  return blogEntries.map((entry: CollectionEntry<'posts'>) => {
    const slugPath = getEntrySlugPath(entry);

    return {
      params: { slug: slugPath },
      props: { entry },
    };
  });
}

interface Props {
  entry: CollectionEntry<'posts'>;
}

const { entry } = Astro.props;
const { Content } = await render(entry);
---

<BaseLayout
  title={entry.data.title + ' - OtÃ¡vio Miranda'}
  description={entry.data.description}
  image={entry.data.image}
>
  <div class='main'>
    <Header />

    <section class='section section-light article-section'>
      <div class='section-content'>
        <article class='article markdown-body article-body'>
          <header class='post-header'>
            <h1 class='post-title'>{entry.data.title}</h1>
            {
              entry.data.description && (
                <p class='post-description'>{entry.data.description}</p>
              )
            }
            <div class='post-meta'>
              {
                entry.data.author && (
                  <span class='post-author'>Por {entry.data.author}</span>
                )
              }
              {
                entry.data.date && (
                  <time
                    class='post-date'
                    datetime={entry.data.date.toISOString()}
                  >
                    {entry.data.date.toLocaleDateString('pt-BR')}
                  </time>
                )
              }
            </div>
          </header>
          <Content />
        </article>
      </div>
    </section>
  </div>

  <Newsletter />
  <Footer />
</BaseLayout>
