<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>
      Instalando o certificado SSL-TLS grátis da Let’s Encrypt - Otávio Miranda
    </title>
    <meta
      name="description"
      content="Instalando o certificado SSL-TLS grátis da Let’s Encrypt"
    />

    <link rel="stylesheet" href="../../css/styles_2026.css" />

    <link rel="icon" type="image/webp" href="../../imgs/favicon-1.webp" />

    <!-- conexão antecipada -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- fonte -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <input
      aria-label="Tema Claro ou Escuro (Temporário)"
      title="Tema Claro ou Escuro (Temporário)"
      id="theme-mode"
      type="checkbox"
    />

    <main class="main">
      <aside class="nav">
        <a class="copyright-link" href="/">Otávio Miranda</a>
        <a
          target="_blank"
          href="https://beacons.ai/otaviomiranda"
          rel="nofollow noopener noreferrer"
          >Contatos</a
        >
      </aside>

      <article class="article">
        <h1>Instalando o certificado SSL-TLS grátis da Let’s Encrypt</h1>

        <p class="author">
          Publicado em 4 de abril de 2018 |
          <strong>Por</strong>
          <a href="/">Luiz Otávio Miranda</a>
        </p>

        <p>
          Nesse artigo voc&ecirc; vai aprender a instalar e configurar o
          certificado SSL-TLS gr&aacute;tis da Let&rsquo;s Encrypt em quantos
          dom&iacute;nios preferir. &Eacute; HTTPS gratuito para todos os seus
          sites.
        </p>

        <p>
          Quando falamos em com&eacute;rcio eletr&ocirc;nico, estamos falando em
          duas coisas extremamente importantes e sens&iacute;veis: dados
          pessoais e dinheiro. Portanto, a seguran&ccedil;a &eacute; primordial
          para que todos os dados passem atrav&eacute;s de conex&otilde;es
          seguras.
        </p>

        <p>
          Certamente, voc&ecirc; j&aacute; deve ter ouvido algum especialista em
          <a href="/categoria/seguranca/">seguran&ccedil;a online</a>
          explicando que, uma das primeiras coisas a se verificar para saber se
          um e-commerce qualquer &eacute; seguro, &eacute; verificar se ele
          possui &ldquo;aquele cadeado&rdquo; falando que a conex&atilde;o
          &eacute; segura (ou, ao inv&eacute;s de usar
          <strong>HTTP</strong> no in&iacute;cio do
          <a href="/2018/dominio-e-hospedagem-guia-para-leigos/"
            >dom&iacute;nio</a
          >, usar <strong>HTTPS</strong>).
        </p>

        <p>
          Na verdade, todos os sites que utilizam
          <a
            href="https://pt.wikipedia.org/wiki/Hyper_Text_Transfer_Protocol_Secure"
            >HTTPS</a
          >
          (<em>Hyper Text Transfer Protocol Secure</em>) t&ecirc;m uma camada
          adicional de seguran&ccedil;a que usa o protocolo
          <a href="https://pt.wikipedia.org/wiki/Transport_Layer_Security"
            >SSL-TLS</a
          >. Essa camada de seguran&ccedil;a permite que dados sejam
          transmitidos por uma conex&atilde;o criptografada que verifica a
          autenticidade do servidor e do computador cliente usando certificados
          SSL-TLS. A porta TCP usada pelo HTTPS &eacute; a 443.
        </p>

        <p>
          Falando em modo superficial, qualquer dado pessoal que o cliente
          digitar em um site com HTTPS, s&oacute; poder&aacute; ser lido no
          servidor para o qual ele foi enviado. Se, por algum motivo, algum
          hacker consiga capturar os dados no meio do caminho, esses dados
          estar&atilde;o fortemente criptografados e seria quase
          imposs&iacute;vel l&ecirc;-los (digo &ldquo;quase&rdquo;, porque nunca
          se sabe, n&eacute;?).
        </p>

        <p>
          Al&eacute;m disso, se voc&ecirc; se preocupa com
          <a href="https://marketingdeconteudo.com/o-que-e-seo/">SEO</a>
          (aparecer primeiro nas buscas), HTTPS tamb&eacute;m dever&aacute;
          ajudar
          <a
            href="https://imasters.com.br/devsecops/o-impacto-ssl-e-o-https-ranking-em-seo"
            >seu site a se posicionar melhor</a
          >
          no google, por exemplo.
        </p>

        <p>
          A
          <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a>
          &eacute; uma autoridade de certifica&ccedil;&atilde;o lan&ccedil;ada
          em 12 de abril de 2016, que fornece certificados SSL-TLS gr&aacute;tis
          atrav&eacute;s de um processo automatizado, criado para eliminar a
          complexidade dos processos atuais de cria&ccedil;&atilde;o,
          valida&ccedil;&atilde;o, instala&ccedil;&atilde;o e
          renova&ccedil;&atilde;o de certificados para sites seguros. Sua
          inten&ccedil;&atilde;o &eacute; fazer com que toda a Internet use
          HTTPS por uma web mais segura.
        </p>

        <p>
          Com poucos comandos voc&ecirc; conseguir&aacute; instalar e configurar
          seu certificado SSL-TLS, habilitando assim HTTPS para seu site.
        </p>

        <p>
          Ent&atilde;o vamos &agrave;s configura&ccedil;&otilde;es. Bora
          l&aacute;!
        </p>

        <h2>Antes de come&ccedil;ar</h2>

        <p>
          Este tutorial &eacute; voltado para a instala&ccedil;&atilde;o do
          certificado SSL-TLS gr&aacute;tis da Let&rsquo;s Encrypt diretamente
          no servidor, sendo, assim, n&atilde;o vou me atentar para
          <a href="/2018/dominio-e-hospedagem-guia-para-leigos/">hospedagens</a>
          que ofere&ccedil;am este recurso em seus respectivos pain&eacute;is.
          Se a sua hospedagem oferece certificado SSL gratuito (certamente,
          &eacute; da Let&rsquo;s Encrypt), por favor, utilize o pr&oacute;prio
          painel da hospedagem para habilitar HTTPS no seu site, certamente,
          eles t&ecirc;m um tutorial explicando como realizar tal procedimento.
        </p>

        <p>
          No momento da cria&ccedil;&atilde;o deste tutorial, estou usando o
          Debian 9. Este tutorial dever&aacute; funcionar perfeitamente em
          qualquer vers&atilde;o baseada em Debian (Ubuntu, Linux Mint e assim
          por diante).
        </p>

        <p>
          Vou explicar como instalar e configurar o certificado. Posteriormente
          no artigo, explicar como configurar um server block para
          <strong>Nginx</strong> e como configurar um Virtualhost para
          <strong>Apache</strong>.
        </p>

        <p>
          Se voc&ecirc; ainda n&atilde;o instalou nem configurou nenhum desses
          servidores Web, siga um dos tutoriais abaixo:
        </p>

        <ul>
          <li>
            <a href="/2018/nginx-php-fpm-no-linux/"
              >nginx + php-fpm no Linux (Debian ou Ubuntu)</a
            >
          </li>
          <li>
            <a href="/2018/apache2-php-fpm-ubuntu-debian/"
              >Como instalar e configurar o Apache2 e o PHP-FPM no Ubuntu ou
              Debian</a
            >
          </li>
        </ul>

        <p>Feito isso, agora &eacute; s&oacute; prosseguir com o tutorial.</p>

        <h2>Instalando o certbot</h2>

        <p>
          <strong>certbot</strong> &eacute; o cliente que vai buscar os
          certificados da Let&rsquo;s Encrypt. Muito f&aacute;cil de usar e
          instalar.
        </p>

        <p>Para instalar basta digitar:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> apt-get</span><span style="color:#A6E3A1"> install</span><span style="color:#A6E3A1"> certbot</span></span></code></pre>

        <p>No seu terminal.</p>

        <h2>Instalando o certificado SSL-TLS</h2>

        <p>
          Ap&oacute;s a instala&ccedil;&atilde;o do certbot, voc&ecirc; precisa
          parar os servi&ccedil;os que rodam na porta 80 (apache ou nginx). Para
          isso basta digitar:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#9399B2;font-style:italic"># Para o nginx</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">service</span><span style="color:#A6E3A1"> nginx</span><span style="color:#A6E3A1"> stop</span></span>
<span class="line"><span style="color:#9399B2;font-style:italic"># Para o apache2</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">service</span><span style="color:#A6E3A1"> apache2</span><span style="color:#A6E3A1"> stop</span></span></code></pre>

        <p>E para instalar o certificado SSL-TLS digite:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> certbot</span><span style="color:#A6E3A1"> certonly</span><span style="color:#A6E3A1"> --standalone</span><span style="color:#A6E3A1"> -d</span><span style="color:#A6E3A1"> meudominio.com.br</span><span style="color:#A6E3A1"> -d</span><span style="color:#A6E3A1"> www.meudominio.com.br</span></span></code></pre>

        <p>
          A &uacute;nica coisa que voc&ecirc; precisa alterar s&atilde;o os
          dom&iacute;nios. Geralmente, um dom&iacute;nio tem duas
          vers&otilde;es:
        </p>

        <ul>
          <li>meudominio.com.br</li>
          <li>www.meudominio.com.br</li>
        </ul>

        <p>
          Ambas apontando para o mesmo local, se esse for o seu caso, no comando
          acima altere apenas a parte &ldquo;meudominio.com.br&rdquo; para o seu
          dom&iacute;nio nos dois locais.
        </p>

        <p>
          Se o seu dom&iacute;nio tem apenas uma vers&atilde;o, use o seguinte
          comando:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> certbot</span><span style="color:#A6E3A1"> certonly</span><span style="color:#A6E3A1"> --standalone</span><span style="color:#A6E3A1"> -d</span><span style="color:#A6E3A1"> meudominio.com.br</span></span></code></pre>

        <p>
          Voc&ecirc; dever&aacute; receber uma mensagem dizendo que est&aacute;
          tudo OK, por exemplo:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">IMPORTANT</span><span style="color:#A6E3A1"> NOTES:</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">-</span><span style="color:#A6E3A1"> Congratulations!</span><span style="color:#A6E3A1"> Your</span><span style="color:#A6E3A1"> certificate</span><span style="color:#A6E3A1"> and</span><span style="color:#A6E3A1"> chain</span><span style="color:#A6E3A1"> have</span><span style="color:#A6E3A1"> been</span><span style="color:#A6E3A1"> saved</span><span style="color:#A6E3A1"> at</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  /etc/letsencrypt/live/meudominio.com.br/fullchain.pem.</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  Your</span><span style="color:#A6E3A1"> cert</span><span style="color:#A6E3A1"> will</span><span style="color:#A6E3A1"> expire</span><span style="color:#A6E3A1"> on</span><span style="color:#A6E3A1"> 2018-11-23.</span><span style="color:#A6E3A1"> To</span><span style="color:#A6E3A1"> obtain</span><span style="color:#A6E3A1"> a</span><span style="color:#A6E3A1"> new</span><span style="color:#A6E3A1"> or</span><span style="color:#A6E3A1"> tweaked</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  version</span><span style="color:#A6E3A1"> of</span><span style="color:#A6E3A1"> this</span><span style="color:#A6E3A1"> certificate</span><span style="color:#A6E3A1"> in</span><span style="color:#A6E3A1"> the</span><span style="color:#A6E3A1"> future,</span><span style="color:#A6E3A1"> simply</span><span style="color:#A6E3A1"> run</span><span style="color:#A6E3A1"> certbot</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  again.</span><span style="color:#A6E3A1"> To</span><span style="color:#A6E3A1"> non-interactively</span><span style="color:#A6E3A1"> renew</span><span style="color:#CDD6F4"> *</span><span style="color:#A6E3A1">all</span><span style="color:#CDD6F4">*</span><span style="color:#A6E3A1"> of</span><span style="color:#A6E3A1"> your</span><span style="color:#A6E3A1"> certificates,</span><span style="color:#A6E3A1"> run</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  "certbot renew"</span></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">-</span><span style="color:#A6E3A1"> If</span><span style="color:#A6E3A1"> you</span><span style="color:#A6E3A1"> like</span><span style="color:#A6E3A1"> Certbot,</span><span style="color:#A6E3A1"> please</span><span style="color:#A6E3A1"> consider</span><span style="color:#A6E3A1"> supporting</span><span style="color:#A6E3A1"> our</span><span style="color:#A6E3A1"> work</span><span style="color:#A6E3A1"> by:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89B4FA;font-style:italic">  Donating</span><span style="color:#A6E3A1"> to</span><span style="color:#A6E3A1"> ISRG</span><span style="color:#A6E3A1"> /</span><span style="color:#A6E3A1"> Let's Encrypt:   https://letsencrypt.org/donate</span></span>
<span class="line"><span style="color:#A6E3A1">  Donating to EFF:                    https://eff.org/donate-le</span></span></code></pre>

        <p>
          Isso quer dizer que seu certificado SSL-TLS foi salvo em
          /etc/letsencrypt/live/meudominio.com.br/.
        </p>

        <p>
          Para cada dom&iacute;nio voc&ecirc; ter&aacute; uma pasta com o nome
          do dom&iacute;nio em quest&atilde;o. Portanto, se voc&ecirc; tem mais
          de um dom&iacute;nio, siga os mesmos passos para gerar um certificado
          SSL-TLS para cada um deles.
        </p>

        <h2>Configurando um Server Block no nginx</h2>

        <p>
          Depois de criar seu certificado SSL-TLS, agora voc&ecirc; precisa
          falar para o nginx as configura&ccedil;&otilde;es SSL. Para isso
          acesse o server block do seu site em
          /etc/nginx/sites-enabled/meudominio.com.br (ou o nome que voc&ecirc;
          deu para o server block do seu site).
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> nano</span><span style="color:#A6E3A1"> /etc/nginx/sites-enabled/meudominio.com.br</span></span></code></pre>

        <p>E adicione as linhas a seguir em vermelho:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#CBA6F7">server</span><span style="color:#CDD6F4"> {</span></span>
<span class="line"><span style="color:#CBA6F7">	listen </span><span style="color:#FAB387">80</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	listen </span><span style="color:#CDD6F4">[::]:80</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	listen </span><span style="color:#FAB387">443</span><span style="color:#CDD6F4"> ssl http2</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	listen </span><span style="color:#CDD6F4">[::]:443 ssl http2</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	ssl_certificate </span><span style="color:#CDD6F4">/etc/letsencrypt/live/meudominio.com.br/fullchain.pem</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_certificate_key </span><span style="color:#CDD6F4">/etc/letsencrypt/live/meudominio.com.br/privkey.pem</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_trusted_certificate </span><span style="color:#CDD6F4">/etc/letsencrypt/live/meudominio.com.br/chain.pem</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	ssl_session_cache </span><span style="color:#CDD6F4">shared:SSL:10m</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_session_timeout </span><span style="color:#FAB387">5m</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	ssl_prefer_server_ciphers </span><span style="color:#F38BA8">on</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_ciphers </span><span style="color:#CDD6F4">ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Desativa SSLv3</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_protocols </span><span style="color:#CDD6F4">TLSv1 TLSv1.1 TLSv1.2</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Diffie-Hellman</span></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# $ sudo openssl dhparam -out /etc/ssl/certs/dhparam.pem 2048</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_dhparam </span><span style="color:#CDD6F4">/etc/ssl/certs/dhparam.pem</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Ativa HSTS</span></span>
<span class="line"><span style="color:#CBA6F7">	add_header </span><span style="color:#CDD6F4">Strict-Transport-Security </span><span style="color:#A6E3A1">"max-age=63072000; includeSubdomains"</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Ativa OCSP stapling</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_stapling </span><span style="color:#F38BA8">on</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	ssl_stapling_verify </span><span style="color:#F38BA8">on</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	resolver </span><span style="color:#FAB387">8.8.8.8</span><span style="color:#FAB387"> 8.8.4.4</span><span style="color:#CDD6F4"> valid=300s</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	resolver_timeout </span><span style="color:#FAB387">5s</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	root </span><span style="color:#CDD6F4">/var/www/meudominio.com.br/public_html/</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Add index.php to the list if you are using PHP</span></span>
<span class="line"><span style="color:#CBA6F7">	index </span><span style="color:#CDD6F4">index.html index.htm index.nginx-debian.html index.php</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	server_name </span><span style="color:#CDD6F4">meudominio.com.br www.meudominio.com.br</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	location</span><span style="color:#CDD6F4"> / {</span></span>
<span class="line"><span style="color:#CBA6F7">		try_files </span><span style="color:#CDD6F4">$uri $uri/ </span><span style="color:#FAB387">=404</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">		# Para WordPress</span></span>
<span class="line"><span style="color:#9399B2;font-style:italic">		# try_files $uri $uri/ /index.php?q=$uri&#x26;$args;</span></span>
<span class="line"><span style="color:#CDD6F4">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	# Passa scripts PHP para o servidor FastCGI (PHP-FPM)</span></span>
<span class="line"><span style="color:#9399B2;font-style:italic">	#</span></span>
<span class="line"><span style="color:#CBA6F7">	location</span><span style="color:#94E2D5"> ~</span><span style="color:#A6E3A1"> \.php$ </span><span style="color:#CDD6F4">{</span></span>
<span class="line"><span style="color:#CBA6F7">		include </span><span style="color:#CDD6F4">snippets/fastcgi-php.conf</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">		fastcgi_intercept_errors </span><span style="color:#F38BA8">on</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9399B2;font-style:italic">		#fastcgi_index index.php;</span></span>
<span class="line"><span style="color:#CBA6F7">		if</span><span style="color:#CDD6F4"> (</span><span style="color:#94E2D5">!-f </span><span style="color:#CDD6F4">$realpath_root$fastcgi_script_name) {</span></span>
<span class="line"><span style="color:#CBA6F7">			return</span><span style="color:#FAB387"> 404</span><span style="color:#CDD6F4">;</span></span>
<span class="line"><span style="color:#CDD6F4">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">		fastcgi_buffers </span><span style="color:#FAB387">16</span><span style="color:#FAB387"> 16k</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">		fastcgi_buffer_size </span><span style="color:#FAB387">32k</span><span style="color:#9399B2">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">		include </span><span style="color:#CDD6F4">/etc/nginx/fastcgi_params</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">		fastcgi_pass </span><span style="color:#CDD6F4">127.0.0.1:9010</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CDD6F4">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	location</span><span style="color:#94E2D5"> ~</span><span style="color:#A6E3A1"> /\. </span><span style="color:#CDD6F4">{</span></span>
<span class="line"><span style="color:#CBA6F7">		access_log </span><span style="color:#F38BA8">off</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">		log_not_found </span><span style="color:#F38BA8">off</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">		deny </span><span style="color:#F38BA8">all</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CDD6F4">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7">	access_log </span><span style="color:#F38BA8">off</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CBA6F7">	error_log </span><span style="color:#CDD6F4">  /var/log/nginx/meudominio.com.br-error.log</span><span style="color:#9399B2">;</span></span>
<span class="line"><span style="color:#CDD6F4">}</span></span></code></pre>

        <p>
          As linhas em vermelho no trecho do server block acima configuram SSL
          no seu nginx.
        </p>

        <p>
          Mais uma coisinha: voc&ecirc; precisa executar mais um comando para
          prevenir
          <a href="https://www.kryptus.com/diffie-hellman-no-openssl/"
            >ataque contra chaves Diffie-Hellman</a
          >
          no OpenSSL.
        </p>

        <p>Para isso digite:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> openssl</span><span style="color:#A6E3A1"> dhparam</span><span style="color:#A6E3A1"> -out</span><span style="color:#A6E3A1"> /etc/ssl/certs/dhparam.pem</span><span style="color:#FAB387"> 4096</span></span></code></pre>

        <p>
          <strong>Aten&ccedil;&atilde;o:</strong> isso vai demorar
          mmmmmmmmmmmuuuuuuuuuuuiiiiiiiiitooo.
        </p>

        <p>
          Por fim, n&atilde;o se esque&ccedil;a de iniciar o nginx novamente.
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> service</span><span style="color:#A6E3A1"> nginx</span><span style="color:#A6E3A1"> start</span></span></code></pre>

        <p>
          Em caso de erros, provavelmente s&atilde;o os caminhos dos arquivos,
          verifique se est&atilde;o todos em seus devidos locais.
        </p>

        <h2>Configurando um Virtualhost no Apache</h2>

        <p>Se voc&ecirc; usa apache, altere seu virtualhost digitando:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> nano</span><span style="color:#A6E3A1"> /etc/apache2/sites-enabled/meudominio.com.br.conf</span></span></code></pre>

        <p>
          Claro, voc&ecirc; precisa alterar o comando acima para o nome do seu
          virtualhost.conf.
        </p>

        <p>
          Eu criei um virtualhost simples aqui no apache na porta 80 que ficou
          assim:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#94E2D5">&#x3C;</span><span style="color:#89B4FA">VirtualHost</span><span style="color:#F9E2AF"> *:80</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">    ServerAdmin webmaster@meudominio.com.br</span></span>
<span class="line"><span style="color:#CDD6F4">    DocumentRoot /var/www/meudominio.com.br/public_html</span></span>
<span class="line"><span style="color:#CDD6F4">    ServerName meudominio.com.br</span></span>
<span class="line"><span style="color:#CDD6F4">    ServerAlias www.meudominio.com.br</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    CustomLog /var/log/apache2/access-meudominio.com.br.br.log combined</span></span>
<span class="line"><span style="color:#CDD6F4">    ErrorLog /var/log/apache2/error-meudominio.com.br.br.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;</span><span style="color:#89B4FA">FilesMatch</span><span style="color:#CDD6F4"> "\.php$"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#94E2D5">        &#x3C;</span><span style="color:#89B4FA">If</span><span style="color:#CDD6F4"> "-f </span><span style="color:#F9E2AF">%{SCRIPT_FILENAME}</span><span style="color:#CDD6F4">"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">            SetHandler "proxy:fcgi://127.0.0.1:9010"</span></span>
<span class="line"><span style="color:#94E2D5">        &#x3C;/</span><span style="color:#89B4FA">If</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;/</span><span style="color:#89B4FA">FilesMatch</span><span style="color:#94E2D5">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;</span><span style="color:#89B4FA">Directory</span><span style="color:#CDD6F4"> "/var/www/meudominio.com.br/public_html"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">        Options FollowSymLinks MultiViews</span></span>
<span class="line"><span style="color:#CDD6F4">        AllowOverride All</span></span>
<span class="line"><span style="color:#CDD6F4">        Order allow,deny</span></span>
<span class="line"><span style="color:#CDD6F4">        allow from all</span></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;/</span><span style="color:#89B4FA">Directory</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#94E2D5">&#x3C;/</span><span style="color:#89B4FA">VirtualHost</span><span style="color:#94E2D5">></span></span></code></pre>

        <p>
          Um virtualhost bem b&aacute;sico com
          <a href="/2018/apache2-php-fpm-ubuntu-debian/">PHP-FPM</a>.
        </p>

        <p>
          Para certificado SSL-TLS, vou clonar esse virtualhost, por&eacute;m
          adicionando algumas coisinhas, veja:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#94E2D5">&#x3C;</span><span style="color:#89B4FA">VirtualHost</span><span style="color:#F9E2AF"> *:443</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">    ServerAdmin webmaster@meudominio.com.br</span></span>
<span class="line"><span style="color:#CDD6F4">    DocumentRoot /var/www/meudominio.com.br/public_html</span></span>
<span class="line"><span style="color:#CDD6F4">    ServerName meudominio.com.br</span></span>
<span class="line"><span style="color:#CDD6F4">    ServerAlias www.meudominio.com.br</span></span>
<span class="line"></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;</span><span style="color:#89B4FA">FilesMatch</span><span style="color:#CDD6F4"> "\.php$"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#94E2D5">        &#x3C;</span><span style="color:#89B4FA">If</span><span style="color:#CDD6F4"> "-f </span><span style="color:#F9E2AF">%{SCRIPT_FILENAME}</span><span style="color:#CDD6F4">"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">            SetHandler "proxy:fcgi://127.0.0.1:9010"</span></span>
<span class="line"><span style="color:#CDD6F4">            #SetHandler "proxy:unix:/var/run/php/php7.2-fpm-om.sock|fcgi://127.0.0.1:9010/"</span></span>
<span class="line"><span style="color:#94E2D5">        &#x3C;/</span><span style="color:#89B4FA">If</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;/</span><span style="color:#89B4FA">FilesMatch</span><span style="color:#94E2D5">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;</span><span style="color:#89B4FA">Directory</span><span style="color:#CDD6F4"> "/var/www/meudominio.com.br/public_html"</span><span style="color:#94E2D5">></span></span>
<span class="line"><span style="color:#CDD6F4">        Options FollowSymLinks MultiViews</span></span>
<span class="line"><span style="color:#CDD6F4">        AllowOverride All</span></span>
<span class="line"><span style="color:#CDD6F4">        Order allow,deny</span></span>
<span class="line"><span style="color:#CDD6F4">        allow from all</span></span>
<span class="line"><span style="color:#94E2D5">    &#x3C;/</span><span style="color:#89B4FA">Directory</span><span style="color:#94E2D5">></span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    CustomLog /var/log/apache2/access-meudominio.com.br.br.log combined</span></span>
<span class="line"><span style="color:#CDD6F4">    ErrorLog /var/log/apache2/error-meudominio.com.br.br.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    SSLEngine on</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    SSLProtocol             all -SSLv2 -SSLv3</span></span>
<span class="line"><span style="color:#CDD6F4">    SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS</span></span>
<span class="line"><span style="color:#CDD6F4">    SSLHonorCipherOrder     on</span></span>
<span class="line"><span style="color:#CDD6F4">    SSLCompression          off</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    SSLOptions +StrictRequire</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CDD6F4">    SSLCertificateFile /etc/letsencrypt/live/meudominio.com.br/fullchain.pem</span></span>
<span class="line"><span style="color:#CDD6F4">    SSLCertificateKeyFile /etc/letsencrypt/live/meudominio.com.br/privkey.pem</span></span>
<span class="line"><span style="color:#94E2D5">&#x3C;/</span><span style="color:#89B4FA">VirtualHost</span><span style="color:#94E2D5">></span></span></code></pre>

        <p>
          As partes em vermelho do c&oacute;digo s&atilde;o as partes que
          adicionei para o certificado SSL-TLS.
        </p>

        <p>
          Voc&ecirc; tamb&eacute;m precisa ativar o m&oacute;dulo SSL do
          apache2, para isso digite:
        </p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">sudo</span><span style="color:#A6E3A1"> a2enmod</span><span style="color:#A6E3A1"> ssl</span></span></code></pre>

        <p>
          Lembre-se tamb&eacute;m que, no apache, voc&ecirc; precisa ter os dois
          virtualhosts, o da porta 80 e o da porta 443.
        </p>

        <p>Para finalizar, inicie o apache:</p>

        <pre
          class="shiki catppuccin-mocha"
          style="background-color: #1e1e2e; color: #cdd6f4"
          tabindex="0"
        ><code><span class="line"><span style="color:#89B4FA;font-style:italic">service</span><span style="color:#A6E3A1"> apache2</span><span style="color:#A6E3A1"> start</span></span></code></pre>

        <p>Prontinho, s&oacute; testar.</p>

        <p>At&eacute; a pr&oacute;xima!</p>
      </article>

      <footer class="nav">
        <a class="copyright-link" href="/">Otávio Miranda</a>
        <a
          target="_blank"
          href="https://beacons.ai/otaviomiranda"
          rel="nofollow noopener noreferrer"
          >Contatos</a
        >
      </footer>
    </main>

    <script defer src="../../js/scripts_2026.js"></script>
  </body>
</html>
